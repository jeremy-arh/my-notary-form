"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/submissions/[id]/transactions/route";
exports.ids = ["app/api/submissions/[id]/transactions/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsubmissions%2F%5Bid%5D%2Ftransactions%2Froute&page=%2Fapi%2Fsubmissions%2F%5Bid%5D%2Ftransactions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsubmissions%2F%5Bid%5D%2Ftransactions%2Froute.ts&appDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsubmissions%2F%5Bid%5D%2Ftransactions%2Froute&page=%2Fapi%2Fsubmissions%2F%5Bid%5D%2Ftransactions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsubmissions%2F%5Bid%5D%2Ftransactions%2Froute.ts&appDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_jerem_OneDrive_Bureau_Nouveau_dossier_3_my_notary_form_client_dashboard_next_app_api_submissions_id_transactions_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/submissions/[id]/transactions/route.ts */ \"(rsc)/./app/api/submissions/[id]/transactions/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/submissions/[id]/transactions/route\",\n        pathname: \"/api/submissions/[id]/transactions\",\n        filename: \"route\",\n        bundlePath: \"app/api/submissions/[id]/transactions/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\jerem\\\\OneDrive\\\\Bureau\\\\Nouveau dossier (3)\\\\my-notary-form\\\\client-dashboard-next\\\\app\\\\api\\\\submissions\\\\[id]\\\\transactions\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_jerem_OneDrive_Bureau_Nouveau_dossier_3_my_notary_form_client_dashboard_next_app_api_submissions_id_transactions_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/submissions/[id]/transactions/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZzdWJtaXNzaW9ucyUyRiU1QmlkJTVEJTJGdHJhbnNhY3Rpb25zJTJGcm91dGUmcGFnZT0lMkZhcGklMkZzdWJtaXNzaW9ucyUyRiU1QmlkJTVEJTJGdHJhbnNhY3Rpb25zJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGc3VibWlzc2lvbnMlMkYlNUJpZCU1RCUyRnRyYW5zYWN0aW9ucyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNqZXJlbSU1Q09uZURyaXZlJTVDQnVyZWF1JTVDTm91dmVhdSUyMGRvc3NpZXIlMjAoMyklNUNteS1ub3RhcnktZm9ybSU1Q2NsaWVudC1kYXNoYm9hcmQtbmV4dCU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDamVyZW0lNUNPbmVEcml2ZSU1Q0J1cmVhdSU1Q05vdXZlYXUlMjBkb3NzaWVyJTIwKDMpJTVDbXktbm90YXJ5LWZvcm0lNUNjbGllbnQtZGFzaGJvYXJkLW5leHQmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ21HO0FBQ2hMO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2xpZW50LWRhc2hib2FyZC8/MGRhNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxqZXJlbVxcXFxPbmVEcml2ZVxcXFxCdXJlYXVcXFxcTm91dmVhdSBkb3NzaWVyICgzKVxcXFxteS1ub3RhcnktZm9ybVxcXFxjbGllbnQtZGFzaGJvYXJkLW5leHRcXFxcYXBwXFxcXGFwaVxcXFxzdWJtaXNzaW9uc1xcXFxbaWRdXFxcXHRyYW5zYWN0aW9uc1xcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc3VibWlzc2lvbnMvW2lkXS90cmFuc2FjdGlvbnMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9zdWJtaXNzaW9ucy9baWRdL3RyYW5zYWN0aW9uc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvc3VibWlzc2lvbnMvW2lkXS90cmFuc2FjdGlvbnMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxqZXJlbVxcXFxPbmVEcml2ZVxcXFxCdXJlYXVcXFxcTm91dmVhdSBkb3NzaWVyICgzKVxcXFxteS1ub3RhcnktZm9ybVxcXFxjbGllbnQtZGFzaGJvYXJkLW5leHRcXFxcYXBwXFxcXGFwaVxcXFxzdWJtaXNzaW9uc1xcXFxbaWRdXFxcXHRyYW5zYWN0aW9uc1xcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvc3VibWlzc2lvbnMvW2lkXS90cmFuc2FjdGlvbnMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsubmissions%2F%5Bid%5D%2Ftransactions%2Froute&page=%2Fapi%2Fsubmissions%2F%5Bid%5D%2Ftransactions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsubmissions%2F%5Bid%5D%2Ftransactions%2Froute.ts&appDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/submissions/[id]/transactions/route.ts":
/*!********************************************************!*\
  !*** ./app/api/submissions/[id]/transactions/route.ts ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var stripe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! stripe */ \"(rsc)/./node_modules/stripe/esm/stripe.esm.node.js\");\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/supabase/server */ \"(rsc)/./lib/supabase/server.ts\");\n/* harmony import */ var _lib_supabase_admin__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/supabase/admin */ \"(rsc)/./lib/supabase/admin.ts\");\n/**\r\n * Fetches Stripe transactions (charges, refunds) and invoice URL for a submission.\r\n */ \n\n\n\nasync function GET(_request, { params }) {\n    try {\n        const { id: submissionId } = await params;\n        if (!submissionId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Missing submission ID\"\n            }, {\n                status: 400\n            });\n        }\n        const stripeSecretKey = process.env.STRIPE_SECRET_KEY;\n        if (!stripeSecretKey) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Stripe not configured\"\n            }, {\n                status: 500\n            });\n        }\n        const supabase = await (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_2__.createClient)();\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const admin = (0,_lib_supabase_admin__WEBPACK_IMPORTED_MODULE_3__.createAdminClient)();\n        const { data: client } = await admin.from(\"client\").select(\"id\").eq(\"user_id\", user.id).maybeSingle();\n        if (!client) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Client not found\"\n            }, {\n                status: 403\n            });\n        }\n        const { data: submission, error: subError } = await admin.from(\"submission\").select(\"id, data, client_id\").eq(\"id\", submissionId).eq(\"client_id\", client.id).single();\n        if (subError || !submission) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Submission not found\"\n            }, {\n                status: 404\n            });\n        }\n        const paymentData = submission.data?.payment;\n        const paymentIntentId = paymentData?.payment_intent_id;\n        const stripeSessionId = paymentData?.stripe_session_id;\n        const transactions = [];\n        let mainInvoiceUrl = paymentData?.invoice_url || null;\n        const stripe = new stripe__WEBPACK_IMPORTED_MODULE_1__[\"default\"](stripeSecretKey, {\n            apiVersion: \"2023-10-16\"\n        });\n        let piIdToUse = paymentIntentId;\n        // Fetch from Stripe session if we have it (most complete data)\n        if (stripeSessionId) {\n            try {\n                const session = await stripe.checkout.sessions.retrieve(stripeSessionId, {\n                    expand: [\n                        \"payment_intent\",\n                        \"invoice\"\n                    ]\n                });\n                if (session.invoice && typeof session.invoice === \"object\") {\n                    mainInvoiceUrl = session.invoice.hosted_invoice_url || session.invoice.invoice_pdf || mainInvoiceUrl;\n                }\n                const pi = session.payment_intent;\n                piIdToUse = typeof pi === \"string\" ? pi : pi?.id || piIdToUse;\n                if (piIdToUse && session.payment_status === \"paid\" && session.amount_total) {\n                    transactions.push({\n                        id: piIdToUse,\n                        type: \"payment\",\n                        amount: (session.amount_total || 0) / 100,\n                        currency: (session.currency || \"eur\").toUpperCase(),\n                        status: session.payment_status || \"succeeded\",\n                        created: session.created || Math.floor(Date.now() / 1000),\n                        receiptUrl: mainInvoiceUrl || undefined,\n                        invoiceUrl: mainInvoiceUrl || undefined,\n                        description: \"Checkout payment\"\n                    });\n                }\n            } catch (e) {\n                console.warn(\"[transactions] Session fetch failed:\", e);\n            }\n        }\n        // Fetch charges and refunds from PaymentIntent for more detail (refunds, receipt URLs)\n        if (piIdToUse) {\n            try {\n                const charges = await stripe.charges.list({\n                    payment_intent: piIdToUse,\n                    limit: 10\n                });\n                const hasFromSession = transactions.length > 0;\n                for (const charge of charges.data){\n                    const receiptUrl = charge.receipt_url || undefined;\n                    if (!mainInvoiceUrl && receiptUrl) mainInvoiceUrl = receiptUrl;\n                    if (!hasFromSession) {\n                        transactions.push({\n                            id: charge.id,\n                            type: \"payment\",\n                            amount: (charge.amount || 0) / 100,\n                            currency: (charge.currency || \"eur\").toUpperCase(),\n                            status: charge.status || \"succeeded\",\n                            created: charge.created,\n                            receiptUrl,\n                            invoiceUrl: receiptUrl,\n                            description: charge.description || undefined\n                        });\n                    } else if (transactions[0] && !transactions[0].receiptUrl && receiptUrl) {\n                        transactions[0].receiptUrl = receiptUrl;\n                        transactions[0].invoiceUrl = receiptUrl;\n                    }\n                    if (charge.refunded && charge.amount_refunded) {\n                        transactions.push({\n                            id: `refund_${charge.id}`,\n                            type: \"refund\",\n                            amount: (charge.amount_refunded || 0) / 100,\n                            currency: (charge.currency || \"eur\").toUpperCase(),\n                            status: \"succeeded\",\n                            created: charge.created,\n                            description: \"Refund\"\n                        });\n                    }\n                }\n            } catch (e) {\n                console.warn(\"[transactions] Charges fetch failed:\", e);\n            }\n        }\n        // Fallback: use data from submission.data.payment if no Stripe fetch worked\n        if (transactions.length === 0 && paymentData?.payment_intent_id && paymentData?.amount_paid) {\n            const paidAt = paymentData.paid_at || new Date().toISOString();\n            transactions.push({\n                id: paymentData.payment_intent_id || \"\",\n                type: \"payment\",\n                amount: (paymentData.amount_paid || 0) / 100,\n                currency: (paymentData.currency || \"eur\").toUpperCase(),\n                status: paymentData.payment_status || \"succeeded\",\n                created: new Date(paidAt).getTime() / 1000,\n                receiptUrl: paymentData.invoice_url || undefined,\n                invoiceUrl: paymentData.invoice_url || undefined\n            });\n            const additional = paymentData.additional_payments || [];\n            additional.forEach((ap)=>{\n                transactions.push({\n                    id: ap.payment_intent_id || `extra_${Date.now()}`,\n                    type: \"payment\",\n                    amount: (ap.amount || 0) / 100,\n                    currency: (ap.currency || \"eur\").toUpperCase(),\n                    status: ap.status || \"succeeded\",\n                    created: ap.created_at ? new Date(ap.created_at).getTime() / 1000 : Date.now() / 1000,\n                    invoiceUrl: ap.invoice_url\n                });\n            });\n            const refunds = paymentData.refunds || [];\n            refunds.forEach((r)=>{\n                transactions.push({\n                    id: r.id || `refund_${Date.now()}`,\n                    type: \"refund\",\n                    amount: (r.amount || 0) / 100,\n                    currency: (paymentData.currency || \"eur\").toUpperCase(),\n                    status: r.status || \"succeeded\",\n                    created: r.created_at ? new Date(r.created_at).getTime() / 1000 : Date.now() / 1000\n                });\n            });\n        }\n        transactions.sort((a, b)=>b.created - a.created);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            transactions,\n            invoiceUrl: mainInvoiceUrl\n        });\n    } catch (err) {\n        console.error(\"[transactions] Error:\", err);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: err instanceof Error ? err.message : \"Failed to fetch transactions\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3N1Ym1pc3Npb25zL1tpZF0vdHJhbnNhY3Rpb25zL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7O0NBRUMsR0FDdUQ7QUFDNUI7QUFDeUI7QUFDSTtBQWNsRCxlQUFlSSxJQUNwQkMsUUFBcUIsRUFDckIsRUFBRUMsTUFBTSxFQUF1QztJQUUvQyxJQUFJO1FBQ0YsTUFBTSxFQUFFQyxJQUFJQyxZQUFZLEVBQUUsR0FBRyxNQUFNRjtRQUNuQyxJQUFJLENBQUNFLGNBQWM7WUFDakIsT0FBT1IscURBQVlBLENBQUNTLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUF3QixHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDN0U7UUFFQSxNQUFNQyxrQkFBa0JDLFFBQVFDLEdBQUcsQ0FBQ0MsaUJBQWlCO1FBQ3JELElBQUksQ0FBQ0gsaUJBQWlCO1lBQ3BCLE9BQU9aLHFEQUFZQSxDQUFDUyxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBd0IsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQzdFO1FBRUEsTUFBTUssV0FBVyxNQUFNZCxrRUFBWUE7UUFDbkMsTUFBTSxFQUFFZSxNQUFNLEVBQUVDLElBQUksRUFBRSxFQUFFLEdBQUcsTUFBTUYsU0FBU0csSUFBSSxDQUFDQyxPQUFPO1FBQ3RELElBQUksQ0FBQ0YsTUFBTTtZQUNULE9BQU9sQixxREFBWUEsQ0FBQ1MsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQWUsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQ3BFO1FBRUEsTUFBTVUsUUFBUWxCLHNFQUFpQkE7UUFDL0IsTUFBTSxFQUFFYyxNQUFNSyxNQUFNLEVBQUUsR0FBRyxNQUFNRCxNQUM1QkUsSUFBSSxDQUFDLFVBQ0xDLE1BQU0sQ0FBQyxNQUNQQyxFQUFFLENBQUMsV0FBV1AsS0FBS1gsRUFBRSxFQUNyQm1CLFdBQVc7UUFFZCxJQUFJLENBQUNKLFFBQVE7WUFDWCxPQUFPdEIscURBQVlBLENBQUNTLElBQUksQ0FBQztnQkFB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QWUsS0FBSSxFQUFHQyxXQUFXO29CQUNqRS9DLFFBQVNnRixFQUFFaEYsTUFBTSxJQUFJO29CQUNyQmdELFNBQVNnQyxFQUFFRixVQUFVLEdBQUcsSUFBSTNCLEtBQUs2QixFQUFFRixVQUFVLEVBQUVMLE9BQU8sS0FBSyxPQUFPdEIsS0FBS0MsR0FBRyxLQUFLO2dCQUNqRjtZQUNGO1FBQ0Y7UUFFQTNCLGFBQWF3RCxJQUFJLENBQUMsQ0FBQ0MsR0FBR0MsSUFBTUEsRUFBRW5DLE9BQU8sR0FBR2tDLEVBQUVsQyxPQUFPO1FBRWpELE9BQU8zRCxxREFBWUEsQ0FBQ1MsSUFBSSxDQUFDO1lBQ3ZCMkI7WUFDQThCLFlBQVk3QjtRQUNkO0lBQ0YsRUFBRSxPQUFPMEQsS0FBSztRQUNaMUIsUUFBUTNELEtBQUssQ0FBQyx5QkFBeUJxRjtRQUN2QyxPQUFPL0YscURBQVlBLENBQUNTLElBQUksQ0FDdEI7WUFBRUMsT0FBT3FGLGVBQWVDLFFBQVFELElBQUlFLE9BQU8sR0FBRztRQUErQixHQUM3RTtZQUFFdEYsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jbGllbnQtZGFzaGJvYXJkLy4vYXBwL2FwaS9zdWJtaXNzaW9ucy9baWRdL3RyYW5zYWN0aW9ucy9yb3V0ZS50cz8wMWQ1Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBGZXRjaGVzIFN0cmlwZSB0cmFuc2FjdGlvbnMgKGNoYXJnZXMsIHJlZnVuZHMpIGFuZCBpbnZvaWNlIFVSTCBmb3IgYSBzdWJtaXNzaW9uLlxyXG4gKi9cclxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xyXG5pbXBvcnQgU3RyaXBlIGZyb20gXCJzdHJpcGVcIjtcclxuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIkAvbGliL3N1cGFiYXNlL3NlcnZlclwiO1xyXG5pbXBvcnQgeyBjcmVhdGVBZG1pbkNsaWVudCB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS9hZG1pblwiO1xyXG5cclxuZXhwb3J0IHR5cGUgU3RyaXBlVHJhbnNhY3Rpb24gPSB7XHJcbiAgaWQ6IHN0cmluZztcclxuICB0eXBlOiBcInBheW1lbnRcIiB8IFwicmVmdW5kXCI7XHJcbiAgYW1vdW50OiBudW1iZXI7XHJcbiAgY3VycmVuY3k6IHN0cmluZztcclxuICBzdGF0dXM6IHN0cmluZztcclxuICBjcmVhdGVkOiBudW1iZXI7XHJcbiAgcmVjZWlwdFVybD86IHN0cmluZztcclxuICBpbnZvaWNlVXJsPzogc3RyaW5nO1xyXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xyXG59O1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChcclxuICBfcmVxdWVzdDogTmV4dFJlcXVlc3QsXHJcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IFByb21pc2U8eyBpZDogc3RyaW5nIH0+IH1cclxuKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgaWQ6IHN1Ym1pc3Npb25JZCB9ID0gYXdhaXQgcGFyYW1zO1xyXG4gICAgaWYgKCFzdWJtaXNzaW9uSWQpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiTWlzc2luZyBzdWJtaXNzaW9uIElEXCIgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdHJpcGVTZWNyZXRLZXkgPSBwcm9jZXNzLmVudi5TVFJJUEVfU0VDUkVUX0tFWTtcclxuICAgIGlmICghc3RyaXBlU2VjcmV0S2V5KSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlN0cmlwZSBub3QgY29uZmlndXJlZFwiIH0sIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcclxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0gfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH0sIHsgc3RhdHVzOiA0MDEgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYWRtaW4gPSBjcmVhdGVBZG1pbkNsaWVudCgpO1xyXG4gICAgY29uc3QgeyBkYXRhOiBjbGllbnQgfSA9IGF3YWl0IGFkbWluXHJcbiAgICAgIC5mcm9tKFwiY2xpZW50XCIpXHJcbiAgICAgIC5zZWxlY3QoXCJpZFwiKVxyXG4gICAgICAuZXEoXCJ1c2VyX2lkXCIsIHVzZXIuaWQpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICAgIGlmICghY2xpZW50KSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIkNsaWVudCBub3QgZm91bmRcIiB9LCB7IHN0YXR1czogNDAzIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogc3VibWlzc2lvbiwgZXJyb3I6IHN1YkVycm9yIH0gPSBhd2FpdCBhZG1pblxyXG4gICAgICAuZnJvbShcInN1Ym1pc3Npb25cIilcclxuICAgICAgLnNlbGVjdChcImlkLCBkYXRhLCBjbGllbnRfaWRcIilcclxuICAgICAgLmVxKFwiaWRcIiwgc3VibWlzc2lvbklkKVxyXG4gICAgICAuZXEoXCJjbGllbnRfaWRcIiwgY2xpZW50LmlkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKHN1YkVycm9yIHx8ICFzdWJtaXNzaW9uKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlN1Ym1pc3Npb24gbm90IGZvdW5kXCIgfSwgeyBzdGF0dXM6IDQwNCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwYXltZW50RGF0YSA9IChzdWJtaXNzaW9uLmRhdGEgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5wYXltZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+IHwgdW5kZWZpbmVkO1xyXG4gICAgY29uc3QgcGF5bWVudEludGVudElkID0gcGF5bWVudERhdGE/LnBheW1lbnRfaW50ZW50X2lkIGFzIHN0cmluZyB8IHVuZGVmaW5lZDtcclxuICAgIGNvbnN0IHN0cmlwZVNlc3Npb25JZCA9IHBheW1lbnREYXRhPy5zdHJpcGVfc2Vzc2lvbl9pZCBhcyBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcblxyXG4gICAgY29uc3QgdHJhbnNhY3Rpb25zOiBTdHJpcGVUcmFuc2FjdGlvbltdID0gW107XHJcbiAgICBsZXQgbWFpbkludm9pY2VVcmw6IHN0cmluZyB8IG51bGwgPSAocGF5bWVudERhdGE/Lmludm9pY2VfdXJsIGFzIHN0cmluZykgfHwgbnVsbDtcclxuXHJcbiAgICBjb25zdCBzdHJpcGUgPSBuZXcgU3RyaXBlKHN0cmlwZVNlY3JldEtleSwgeyBhcGlWZXJzaW9uOiBcIjIwMjMtMTAtMTZcIiB9KTtcclxuXHJcbiAgICBsZXQgcGlJZFRvVXNlID0gcGF5bWVudEludGVudElkO1xyXG5cclxuICAgIC8vIEZldGNoIGZyb20gU3RyaXBlIHNlc3Npb24gaWYgd2UgaGF2ZSBpdCAobW9zdCBjb21wbGV0ZSBkYXRhKVxyXG4gICAgaWYgKHN0cmlwZVNlc3Npb25JZCkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBzdHJpcGUuY2hlY2tvdXQuc2Vzc2lvbnMucmV0cmlldmUoc3RyaXBlU2Vzc2lvbklkLCB7XHJcbiAgICAgICAgICBleHBhbmQ6IFtcInBheW1lbnRfaW50ZW50XCIsIFwiaW52b2ljZVwiXSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKHNlc3Npb24uaW52b2ljZSAmJiB0eXBlb2Ygc2Vzc2lvbi5pbnZvaWNlID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICBtYWluSW52b2ljZVVybCA9IHNlc3Npb24uaW52b2ljZS5ob3N0ZWRfaW52b2ljZV91cmwgfHwgc2Vzc2lvbi5pbnZvaWNlLmludm9pY2VfcGRmIHx8IG1haW5JbnZvaWNlVXJsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcGkgPSBzZXNzaW9uLnBheW1lbnRfaW50ZW50O1xyXG4gICAgICAgIHBpSWRUb1VzZSA9IHR5cGVvZiBwaSA9PT0gXCJzdHJpbmdcIiA/IHBpIDogKHBpIGFzIHsgaWQ/OiBzdHJpbmcgfSk/LmlkIHx8IHBpSWRUb1VzZTtcclxuXHJcbiAgICAgICAgaWYgKHBpSWRUb1VzZSAmJiBzZXNzaW9uLnBheW1lbnRfc3RhdHVzID09PSBcInBhaWRcIiAmJiBzZXNzaW9uLmFtb3VudF90b3RhbCkge1xyXG4gICAgICAgICAgdHJhbnNhY3Rpb25zLnB1c2goe1xyXG4gICAgICAgICAgICBpZDogcGlJZFRvVXNlLFxyXG4gICAgICAgICAgICB0eXBlOiBcInBheW1lbnRcIixcclxuICAgICAgICAgICAgYW1vdW50OiAoc2Vzc2lvbi5hbW91bnRfdG90YWwgfHwgMCkgLyAxMDAsXHJcbiAgICAgICAgICAgIGN1cnJlbmN5OiAoc2Vzc2lvbi5jdXJyZW5jeSB8fCBcImV1clwiKS50b1VwcGVyQ2FzZSgpLFxyXG4gICAgICAgICAgICBzdGF0dXM6IHNlc3Npb24ucGF5bWVudF9zdGF0dXMgfHwgXCJzdWNjZWVkZWRcIixcclxuICAgICAgICAgICAgY3JlYXRlZDogc2Vzc2lvbi5jcmVhdGVkIHx8IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApLFxyXG4gICAgICAgICAgICByZWNlaXB0VXJsOiBtYWluSW52b2ljZVVybCB8fCB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIGludm9pY2VVcmw6IG1haW5JbnZvaWNlVXJsIHx8IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiQ2hlY2tvdXQgcGF5bWVudFwiLFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKFwiW3RyYW5zYWN0aW9uc10gU2Vzc2lvbiBmZXRjaCBmYWlsZWQ6XCIsIGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRmV0Y2ggY2hhcmdlcyBhbmQgcmVmdW5kcyBmcm9tIFBheW1lbnRJbnRlbnQgZm9yIG1vcmUgZGV0YWlsIChyZWZ1bmRzLCByZWNlaXB0IFVSTHMpXHJcbiAgICBpZiAocGlJZFRvVXNlKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgY2hhcmdlcyA9IGF3YWl0IHN0cmlwZS5jaGFyZ2VzLmxpc3Qoe1xyXG4gICAgICAgICAgcGF5bWVudF9pbnRlbnQ6IHBpSWRUb1VzZSxcclxuICAgICAgICAgIGxpbWl0OiAxMCxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgaGFzRnJvbVNlc3Npb24gPSB0cmFuc2FjdGlvbnMubGVuZ3RoID4gMDtcclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBjaGFyZ2Ugb2YgY2hhcmdlcy5kYXRhKSB7XHJcbiAgICAgICAgICBjb25zdCByZWNlaXB0VXJsID0gY2hhcmdlLnJlY2VpcHRfdXJsIHx8IHVuZGVmaW5lZDtcclxuICAgICAgICAgIGlmICghbWFpbkludm9pY2VVcmwgJiYgcmVjZWlwdFVybCkgbWFpbkludm9pY2VVcmwgPSByZWNlaXB0VXJsO1xyXG5cclxuICAgICAgICAgIGlmICghaGFzRnJvbVNlc3Npb24pIHtcclxuICAgICAgICAgICAgdHJhbnNhY3Rpb25zLnB1c2goe1xyXG4gICAgICAgICAgICAgIGlkOiBjaGFyZ2UuaWQsXHJcbiAgICAgICAgICAgICAgdHlwZTogXCJwYXltZW50XCIsXHJcbiAgICAgICAgICAgICAgYW1vdW50OiAoY2hhcmdlLmFtb3VudCB8fCAwKSAvIDEwMCxcclxuICAgICAgICAgICAgICBjdXJyZW5jeTogKGNoYXJnZS5jdXJyZW5jeSB8fCBcImV1clwiKS50b1VwcGVyQ2FzZSgpLFxyXG4gICAgICAgICAgICAgIHN0YXR1czogY2hhcmdlLnN0YXR1cyB8fCBcInN1Y2NlZWRlZFwiLFxyXG4gICAgICAgICAgICAgIGNyZWF0ZWQ6IGNoYXJnZS5jcmVhdGVkLFxyXG4gICAgICAgICAgICAgIHJlY2VpcHRVcmwsXHJcbiAgICAgICAgICAgICAgaW52b2ljZVVybDogcmVjZWlwdFVybCxcclxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogY2hhcmdlLmRlc2NyaXB0aW9uIHx8IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKHRyYW5zYWN0aW9uc1swXSAmJiAhdHJhbnNhY3Rpb25zWzBdLnJlY2VpcHRVcmwgJiYgcmVjZWlwdFVybCkge1xyXG4gICAgICAgICAgICB0cmFuc2FjdGlvbnNbMF0ucmVjZWlwdFVybCA9IHJlY2VpcHRVcmw7XHJcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uc1swXS5pbnZvaWNlVXJsID0gcmVjZWlwdFVybDtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiAoY2hhcmdlLnJlZnVuZGVkICYmIGNoYXJnZS5hbW91bnRfcmVmdW5kZWQpIHtcclxuICAgICAgICAgICAgdHJhbnNhY3Rpb25zLnB1c2goe1xyXG4gICAgICAgICAgICAgIGlkOiBgcmVmdW5kXyR7Y2hhcmdlLmlkfWAsXHJcbiAgICAgICAgICAgICAgdHlwZTogXCJyZWZ1bmRcIixcclxuICAgICAgICAgICAgICBhbW91bnQ6IChjaGFyZ2UuYW1vdW50X3JlZnVuZGVkIHx8IDApIC8gMTAwLFxyXG4gICAgICAgICAgICAgIGN1cnJlbmN5OiAoY2hhcmdlLmN1cnJlbmN5IHx8IFwiZXVyXCIpLnRvVXBwZXJDYXNlKCksXHJcbiAgICAgICAgICAgICAgc3RhdHVzOiBcInN1Y2NlZWRlZFwiLFxyXG4gICAgICAgICAgICAgIGNyZWF0ZWQ6IGNoYXJnZS5jcmVhdGVkLFxyXG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlJlZnVuZFwiLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oXCJbdHJhbnNhY3Rpb25zXSBDaGFyZ2VzIGZldGNoIGZhaWxlZDpcIiwgZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBGYWxsYmFjazogdXNlIGRhdGEgZnJvbSBzdWJtaXNzaW9uLmRhdGEucGF5bWVudCBpZiBubyBTdHJpcGUgZmV0Y2ggd29ya2VkXHJcbiAgICBpZiAodHJhbnNhY3Rpb25zLmxlbmd0aCA9PT0gMCAmJiBwYXltZW50RGF0YT8ucGF5bWVudF9pbnRlbnRfaWQgJiYgcGF5bWVudERhdGE/LmFtb3VudF9wYWlkKSB7XHJcbiAgICAgIGNvbnN0IHBhaWRBdCA9IChwYXltZW50RGF0YS5wYWlkX2F0IGFzIHN0cmluZykgfHwgbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xyXG4gICAgICB0cmFuc2FjdGlvbnMucHVzaCh7XHJcbiAgICAgICAgaWQ6IChwYXltZW50RGF0YS5wYXltZW50X2ludGVudF9pZCBhcyBzdHJpbmcpIHx8IFwiXCIsXHJcbiAgICAgICAgdHlwZTogXCJwYXltZW50XCIsXHJcbiAgICAgICAgYW1vdW50OiAoKHBheW1lbnREYXRhLmFtb3VudF9wYWlkIGFzIG51bWJlcikgfHwgMCkgLyAxMDAsXHJcbiAgICAgICAgY3VycmVuY3k6ICgocGF5bWVudERhdGEuY3VycmVuY3kgYXMgc3RyaW5nKSB8fCBcImV1clwiKS50b1VwcGVyQ2FzZSgpLFxyXG4gICAgICAgIHN0YXR1czogKHBheW1lbnREYXRhLnBheW1lbnRfc3RhdHVzIGFzIHN0cmluZykgfHwgXCJzdWNjZWVkZWRcIixcclxuICAgICAgICBjcmVhdGVkOiBuZXcgRGF0ZShwYWlkQXQpLmdldFRpbWUoKSAvIDEwMDAsXHJcbiAgICAgICAgcmVjZWlwdFVybDogKHBheW1lbnREYXRhLmludm9pY2VfdXJsIGFzIHN0cmluZykgfHwgdW5kZWZpbmVkLFxyXG4gICAgICAgIGludm9pY2VVcmw6IChwYXltZW50RGF0YS5pbnZvaWNlX3VybCBhcyBzdHJpbmcpIHx8IHVuZGVmaW5lZCxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBhZGRpdGlvbmFsID0gKHBheW1lbnREYXRhLmFkZGl0aW9uYWxfcGF5bWVudHMgYXMgQXJyYXk8eyBwYXltZW50X2ludGVudF9pZD86IHN0cmluZzsgYW1vdW50PzogbnVtYmVyOyBjdXJyZW5jeT86IHN0cmluZzsgc3RhdHVzPzogc3RyaW5nOyBjcmVhdGVkX2F0Pzogc3RyaW5nOyBpbnZvaWNlX3VybD86IHN0cmluZyB9PikgfHwgW107XHJcbiAgICAgIGFkZGl0aW9uYWwuZm9yRWFjaCgoYXApID0+IHtcclxuICAgICAgICB0cmFuc2FjdGlvbnMucHVzaCh7XHJcbiAgICAgICAgICBpZDogKGFwLnBheW1lbnRfaW50ZW50X2lkIHx8IGBleHRyYV8ke0RhdGUubm93KCl9YCkgYXMgc3RyaW5nLFxyXG4gICAgICAgICAgdHlwZTogXCJwYXltZW50XCIsXHJcbiAgICAgICAgICBhbW91bnQ6ICgoYXAuYW1vdW50IHx8IDApIC8gMTAwKSBhcyBudW1iZXIsXHJcbiAgICAgICAgICBjdXJyZW5jeTogKChhcC5jdXJyZW5jeSB8fCBcImV1clwiKSBhcyBzdHJpbmcpLnRvVXBwZXJDYXNlKCksXHJcbiAgICAgICAgICBzdGF0dXM6IChhcC5zdGF0dXMgfHwgXCJzdWNjZWVkZWRcIikgYXMgc3RyaW5nLFxyXG4gICAgICAgICAgY3JlYXRlZDogYXAuY3JlYXRlZF9hdCA/IG5ldyBEYXRlKGFwLmNyZWF0ZWRfYXQpLmdldFRpbWUoKSAvIDEwMDAgOiBEYXRlLm5vdygpIC8gMTAwMCxcclxuICAgICAgICAgIGludm9pY2VVcmw6IGFwLmludm9pY2VfdXJsLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlZnVuZHMgPSAocGF5bWVudERhdGEucmVmdW5kcyBhcyBBcnJheTx7IGlkPzogc3RyaW5nOyBhbW91bnQ/OiBudW1iZXI7IGN1cnJlbmN5Pzogc3RyaW5nOyBzdGF0dXM/OiBzdHJpbmc7IGNyZWF0ZWRfYXQ/OiBzdHJpbmcgfT4pIHx8IFtdO1xyXG4gICAgICByZWZ1bmRzLmZvckVhY2goKHIpID0+IHtcclxuICAgICAgICB0cmFuc2FjdGlvbnMucHVzaCh7XHJcbiAgICAgICAgICBpZDogKHIuaWQgfHwgYHJlZnVuZF8ke0RhdGUubm93KCl9YCkgYXMgc3RyaW5nLFxyXG4gICAgICAgICAgdHlwZTogXCJyZWZ1bmRcIixcclxuICAgICAgICAgIGFtb3VudDogKChyLmFtb3VudCB8fCAwKSAvIDEwMCkgYXMgbnVtYmVyLFxyXG4gICAgICAgICAgY3VycmVuY3k6ICgocGF5bWVudERhdGEuY3VycmVuY3kgYXMgc3RyaW5nKSB8fCBcImV1clwiKS50b1VwcGVyQ2FzZSgpLFxyXG4gICAgICAgICAgc3RhdHVzOiAoci5zdGF0dXMgfHwgXCJzdWNjZWVkZWRcIikgYXMgc3RyaW5nLFxyXG4gICAgICAgICAgY3JlYXRlZDogci5jcmVhdGVkX2F0ID8gbmV3IERhdGUoci5jcmVhdGVkX2F0KS5nZXRUaW1lKCkgLyAxMDAwIDogRGF0ZS5ub3coKSAvIDEwMDAsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHRyYW5zYWN0aW9ucy5zb3J0KChhLCBiKSA9PiBiLmNyZWF0ZWQgLSBhLmNyZWF0ZWQpO1xyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgIHRyYW5zYWN0aW9ucyxcclxuICAgICAgaW52b2ljZVVybDogbWFpbkludm9pY2VVcmwsXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJbdHJhbnNhY3Rpb25zXSBFcnJvcjpcIiwgZXJyKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBlcnJvcjogZXJyIGluc3RhbmNlb2YgRXJyb3IgPyBlcnIubWVzc2FnZSA6IFwiRmFpbGVkIHRvIGZldGNoIHRyYW5zYWN0aW9uc1wiIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIlN0cmlwZSIsImNyZWF0ZUNsaWVudCIsImNyZWF0ZUFkbWluQ2xpZW50IiwiR0VUIiwiX3JlcXVlc3QiLCJwYXJhbXMiLCJpZCIsInN1Ym1pc3Npb25JZCIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsInN0cmlwZVNlY3JldEtleSIsInByb2Nlc3MiLCJlbnYiLCJTVFJJUEVfU0VDUkVUX0tFWSIsInN1cGFiYXNlIiwiZGF0YSIsInVzZXIiLCJhdXRoIiwiZ2V0VXNlciIsImFkbWluIiwiY2xpZW50IiwiZnJvbSIsInNlbGVjdCIsImVxIiwibWF5YmVTaW5nbGUiLCJzdWJtaXNzaW9uIiwic3ViRXJyb3IiLCJzaW5nbGUiLCJwYXltZW50RGF0YSIsInBheW1lbnQiLCJwYXltZW50SW50ZW50SWQiLCJwYXltZW50X2ludGVudF9pZCIsInN0cmlwZVNlc3Npb25JZCIsInN0cmlwZV9zZXNzaW9uX2lkIiwidHJhbnNhY3Rpb25zIiwibWFpbkludm9pY2VVcmwiLCJpbnZvaWNlX3VybCIsInN0cmlwZSIsImFwaVZlcnNpb24iLCJwaUlkVG9Vc2UiLCJzZXNzaW9uIiwiY2hlY2tvdXQiLCJzZXNzaW9ucyIsInJldHJpZXZlIiwiZXhwYW5kIiwiaW52b2ljZSIsImhvc3RlZF9pbnZvaWNlX3VybCIsImludm9pY2VfcGRmIiwicGkiLCJwYXltZW50X2ludGVudCIsInBheW1lbnRfc3RhdHVzIiwiYW1vdW50X3RvdGFsIiwicHVzaCIsInR5cGUiLCJhbW91bnQiLCJjdXJyZW5jeSIsInRvVXBwZXJDYXNlIiwiY3JlYXRlZCIsIk1hdGgiLCJmbG9vciIsIkRhdGUiLCJub3ciLCJyZWNlaXB0VXJsIiwidW5kZWZpbmVkIiwiaW52b2ljZVVybCIsImRlc2NyaXB0aW9uIiwiZSIsImNvbnNvbGUiLCJ3YXJuIiwiY2hhcmdlcyIsImxpc3QiLCJsaW1pdCIsImhhc0Zyb21TZXNzaW9uIiwibGVuZ3RoIiwiY2hhcmdlIiwicmVjZWlwdF91cmwiLCJyZWZ1bmRlZCIsImFtb3VudF9yZWZ1bmRlZCIsImFtb3VudF9wYWlkIiwicGFpZEF0IiwicGFpZF9hdCIsInRvSVNPU3RyaW5nIiwiZ2V0VGltZSIsImFkZGl0aW9uYWwiLCJhZGRpdGlvbmFsX3BheW1lbnRzIiwiZm9yRWFjaCIsImFwIiwiY3JlYXRlZF9hdCIsInJlZnVuZHMiLCJyIiwic29ydCIsImEiLCJiIiwiZXJyIiwiRXJyb3IiLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/submissions/[id]/transactions/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase/admin.ts":
/*!*******************************!*\
  !*** ./lib/supabase/admin.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createAdminClient: () => (/* binding */ createAdminClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/index.mjs\");\n\n/**\r\n * Supabase admin client with service role key.\r\n * Use only in API routes / server-side for privileged operations.\r\n */ function createAdminClient() {\n    const url = \"https://jlizwheftlnhoifbqeex.supabase.co\";\n    const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!url || !serviceKey) {\n        throw new Error(\"Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, serviceKey);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2UvYWRtaW4udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBcUQ7QUFFckQ7OztDQUdDLEdBQ00sU0FBU0M7SUFDZCxNQUFNQyxNQUFNQywwQ0FBb0M7SUFDaEQsTUFBTUcsYUFBYUgsUUFBUUMsR0FBRyxDQUFDRyx5QkFBeUI7SUFFeEQsSUFBSSxDQUFDTCxPQUFPLENBQUNJLFlBQVk7UUFDdkIsTUFBTSxJQUFJRSxNQUFNO0lBQ2xCO0lBRUEsT0FBT1IsbUVBQVlBLENBQUNFLEtBQUtJO0FBQzNCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2xpZW50LWRhc2hib2FyZC8uL2xpYi9zdXBhYmFzZS9hZG1pbi50cz84MTZiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcclxuXHJcbi8qKlxyXG4gKiBTdXBhYmFzZSBhZG1pbiBjbGllbnQgd2l0aCBzZXJ2aWNlIHJvbGUga2V5LlxyXG4gKiBVc2Ugb25seSBpbiBBUEkgcm91dGVzIC8gc2VydmVyLXNpZGUgZm9yIHByaXZpbGVnZWQgb3BlcmF0aW9ucy5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVBZG1pbkNsaWVudCgpIHtcclxuICBjb25zdCB1cmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XHJcbiAgY29uc3Qgc2VydmljZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVk7XHJcblxyXG4gIGlmICghdXJsIHx8ICFzZXJ2aWNlS2V5KSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIFNVUEFCQVNFX1VSTCBvciBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZXCIpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNyZWF0ZUNsaWVudCh1cmwsIHNlcnZpY2VLZXkpO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJjcmVhdGVBZG1pbkNsaWVudCIsInVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzZXJ2aWNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIkVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase/admin.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase/server.ts":
/*!********************************!*\
  !*** ./lib/supabase/server.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createClient: () => (/* binding */ createClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/ssr */ \"(rsc)/./node_modules/@supabase/ssr/dist/module/index.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n\n\nasync function createClient() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    return (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createServerClient)(\"https://jlizwheftlnhoifbqeex.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpsaXp3aGVmdGxuaG9pZmJxZWV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwNjYxODQsImV4cCI6MjA3NjY0MjE4NH0.fgNPzBgLkS7vSpV4cPlS_lvRb4MWp8gn8DPMqXgTbyE\", {\n        cookies: {\n            getAll () {\n                return cookieStore.getAll();\n            },\n            setAll (cookiesToSet) {\n                try {\n                    cookiesToSet.forEach(({ name, value, options })=>cookieStore.set(name, value, options));\n                } catch  {\n                // Ignore in Server Components\n                }\n            }\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2Uvc2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFtRDtBQUNaO0FBRWhDLGVBQWVFO0lBQ3BCLE1BQU1DLGNBQWMsTUFBTUYscURBQU9BO0lBRWpDLE9BQU9ELGlFQUFrQkEsQ0FDdkJJLDBDQUFvQyxFQUNwQ0Esa05BQXlDLEVBQ3pDO1FBQ0VILFNBQVM7WUFDUE87Z0JBQ0UsT0FBT0wsWUFBWUssTUFBTTtZQUMzQjtZQUNBQyxRQUFPQyxZQUFZO2dCQUNqQixJQUFJO29CQUNGQSxhQUFhQyxPQUFPLENBQUMsQ0FBQyxFQUFFQyxJQUFJLEVBQUVDLEtBQUssRUFBRUMsT0FBTyxFQUFFLEdBQzVDWCxZQUFZWSxHQUFHLENBQUNILE1BQU1DLE9BQU9DO2dCQUVqQyxFQUFFLE9BQU07Z0JBQ04sOEJBQThCO2dCQUNoQztZQUNGO1FBQ0Y7SUFDRjtBQUVKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2xpZW50LWRhc2hib2FyZC8uL2xpYi9zdXBhYmFzZS9zZXJ2ZXIudHM/NjYyNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVTZXJ2ZXJDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3NzclwiO1xyXG5pbXBvcnQgeyBjb29raWVzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNsaWVudCgpIHtcclxuICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKTtcclxuXHJcbiAgcmV0dXJuIGNyZWF0ZVNlcnZlckNsaWVudChcclxuICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXHJcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSEsXHJcbiAgICB7XHJcbiAgICAgIGNvb2tpZXM6IHtcclxuICAgICAgICBnZXRBbGwoKSB7XHJcbiAgICAgICAgICByZXR1cm4gY29va2llU3RvcmUuZ2V0QWxsKCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXRBbGwoY29va2llc1RvU2V0KSB7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb29raWVzVG9TZXQuZm9yRWFjaCgoeyBuYW1lLCB2YWx1ZSwgb3B0aW9ucyB9KSA9PlxyXG4gICAgICAgICAgICAgIGNvb2tpZVN0b3JlLnNldChuYW1lLCB2YWx1ZSwgb3B0aW9ucylcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgICAgICAvLyBJZ25vcmUgaW4gU2VydmVyIENvbXBvbmVudHNcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICB9LFxyXG4gICAgfVxyXG4gICk7XHJcbn1cclxuIl0sIm5hbWVzIjpbImNyZWF0ZVNlcnZlckNsaWVudCIsImNvb2tpZXMiLCJjcmVhdGVDbGllbnQiLCJjb29raWVTdG9yZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImdldEFsbCIsInNldEFsbCIsImNvb2tpZXNUb1NldCIsImZvckVhY2giLCJuYW1lIiwidmFsdWUiLCJvcHRpb25zIiwic2V0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase/server.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tslib","vendor-chunks/iceberg-js","vendor-chunks/cookie","vendor-chunks/stripe","vendor-chunks/math-intrinsics","vendor-chunks/es-errors","vendor-chunks/qs","vendor-chunks/call-bind-apply-helpers","vendor-chunks/get-proto","vendor-chunks/object-inspect","vendor-chunks/has-symbols","vendor-chunks/gopd","vendor-chunks/function-bind","vendor-chunks/side-channel","vendor-chunks/side-channel-weakmap","vendor-chunks/side-channel-map","vendor-chunks/side-channel-list","vendor-chunks/hasown","vendor-chunks/get-intrinsic","vendor-chunks/es-object-atoms","vendor-chunks/es-define-property","vendor-chunks/dunder-proto","vendor-chunks/call-bound"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsubmissions%2F%5Bid%5D%2Ftransactions%2Froute&page=%2Fapi%2Fsubmissions%2F%5Bid%5D%2Ftransactions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsubmissions%2F%5Bid%5D%2Ftransactions%2Froute.ts&appDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();