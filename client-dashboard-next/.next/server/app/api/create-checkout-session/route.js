"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/create-checkout-session/route";
exports.ids = ["app/api/create-checkout-session/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcreate-checkout-session%2Froute&page=%2Fapi%2Fcreate-checkout-session%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcreate-checkout-session%2Froute.ts&appDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcreate-checkout-session%2Froute&page=%2Fapi%2Fcreate-checkout-session%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcreate-checkout-session%2Froute.ts&appDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_jerem_OneDrive_Bureau_Nouveau_dossier_3_my_notary_form_client_dashboard_next_app_api_create_checkout_session_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/create-checkout-session/route.ts */ \"(rsc)/./app/api/create-checkout-session/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/create-checkout-session/route\",\n        pathname: \"/api/create-checkout-session\",\n        filename: \"route\",\n        bundlePath: \"app/api/create-checkout-session/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\jerem\\\\OneDrive\\\\Bureau\\\\Nouveau dossier (3)\\\\my-notary-form\\\\client-dashboard-next\\\\app\\\\api\\\\create-checkout-session\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_jerem_OneDrive_Bureau_Nouveau_dossier_3_my_notary_form_client_dashboard_next_app_api_create_checkout_session_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/create-checkout-session/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjcmVhdGUtY2hlY2tvdXQtc2Vzc2lvbiUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGY3JlYXRlLWNoZWNrb3V0LXNlc3Npb24lMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZjcmVhdGUtY2hlY2tvdXQtc2Vzc2lvbiUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNqZXJlbSU1Q09uZURyaXZlJTVDQnVyZWF1JTVDTm91dmVhdSUyMGRvc3NpZXIlMjAoMyklNUNteS1ub3RhcnktZm9ybSU1Q2NsaWVudC1kYXNoYm9hcmQtbmV4dCU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDamVyZW0lNUNPbmVEcml2ZSU1Q0J1cmVhdSU1Q05vdXZlYXUlMjBkb3NzaWVyJTIwKDMpJTVDbXktbm90YXJ5LWZvcm0lNUNjbGllbnQtZGFzaGJvYXJkLW5leHQmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzJGO0FBQ3hLO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2xpZW50LWRhc2hib2FyZC8/ZGM3YyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxqZXJlbVxcXFxPbmVEcml2ZVxcXFxCdXJlYXVcXFxcTm91dmVhdSBkb3NzaWVyICgzKVxcXFxteS1ub3RhcnktZm9ybVxcXFxjbGllbnQtZGFzaGJvYXJkLW5leHRcXFxcYXBwXFxcXGFwaVxcXFxjcmVhdGUtY2hlY2tvdXQtc2Vzc2lvblxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY3JlYXRlLWNoZWNrb3V0LXNlc3Npb24vcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jcmVhdGUtY2hlY2tvdXQtc2Vzc2lvblwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvY3JlYXRlLWNoZWNrb3V0LXNlc3Npb24vcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxqZXJlbVxcXFxPbmVEcml2ZVxcXFxCdXJlYXVcXFxcTm91dmVhdSBkb3NzaWVyICgzKVxcXFxteS1ub3RhcnktZm9ybVxcXFxjbGllbnQtZGFzaGJvYXJkLW5leHRcXFxcYXBwXFxcXGFwaVxcXFxjcmVhdGUtY2hlY2tvdXQtc2Vzc2lvblxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvY3JlYXRlLWNoZWNrb3V0LXNlc3Npb24vcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcreate-checkout-session%2Froute&page=%2Fapi%2Fcreate-checkout-session%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcreate-checkout-session%2Froute.ts&appDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/create-checkout-session/route.ts":
/*!**************************************************!*\
  !*** ./app/api/create-checkout-session/route.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var stripe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! stripe */ \"(rsc)/./node_modules/stripe/esm/stripe.esm.node.js\");\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/supabase/server */ \"(rsc)/./lib/supabase/server.ts\");\n/* harmony import */ var _lib_supabase_admin__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/supabase/admin */ \"(rsc)/./lib/supabase/admin.ts\");\n/**\r\n * API route to create Stripe checkout session.\r\n * Full implementation (no Edge Function) - uses Stripe + Supabase directly.\r\n */ \n\n\n\n// Taux identiques au client (lib/utils/currency.ts) pour cohérence Summary <-> Stripe\nconst CLIENT_FALLBACK_RATES = {\n    USD: 1.1,\n    GBP: 0.85,\n    CAD: 1.5,\n    AUD: 1.65,\n    CHF: 0.95,\n    JPY: 165,\n    CNY: 7.8\n};\nfunction convertPriceToMatchClient(eurAmount, targetCurrency) {\n    if (!eurAmount || !targetCurrency || targetCurrency.toUpperCase() === \"EUR\") return eurAmount;\n    const rate = CLIENT_FALLBACK_RATES[targetCurrency.toUpperCase()] ?? 1;\n    if (targetCurrency.toUpperCase() === \"JPY\") return Math.round(eurAmount * rate);\n    return Math.round(eurAmount * rate * 100) / 100;\n}\nasync function POST(request) {\n    let formData = null;\n    let submissionId;\n    try {\n        const body = await request.json();\n        formData = body.formData;\n        submissionId = body.submissionId;\n        if (!formData) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Missing required field: formData\"\n            }, {\n                status: 400\n            });\n        }\n        // Exiger les données client réelles (pas de création en tant qu'invité)\n        const email = formData.email?.trim();\n        const firstName = formData.firstName?.trim();\n        const lastName = formData.lastName?.trim();\n        if (!email || !firstName || !lastName) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Email, first name and last name are required to create a client account\"\n            }, {\n                status: 400\n            });\n        }\n        const stripeSecretKey = process.env.STRIPE_SECRET_KEY;\n        const supabaseUrl = \"https://jlizwheftlnhoifbqeex.supabase.co\";\n        const supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpsaXp3aGVmdGxuaG9pZmJxZWV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwNjYxODQsImV4cCI6MjA3NjY0MjE4NH0.fgNPzBgLkS7vSpV4cPlS_lvRb4MWp8gn8DPMqXgTbyE\";\n        const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n        if (!stripeSecretKey || !supabaseUrl || !supabaseServiceKey) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Missing STRIPE_SECRET_KEY, SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY\"\n            }, {\n                status: 500\n            });\n        }\n        const stripe = new stripe__WEBPACK_IMPORTED_MODULE_1__[\"default\"](stripeSecretKey, {\n            apiVersion: \"2023-10-16\"\n        });\n        const supabase = (0,_lib_supabase_admin__WEBPACK_IMPORTED_MODULE_3__.createAdminClient)();\n        let currency = (body.currency || formData.currency || \"EUR\").toUpperCase();\n        const stripeCurrency = currency.toLowerCase();\n        const promoCode = body.promoCode || formData.promoCode;\n        const promoCodeId = body.promoCodeId || formData.promoCodeId;\n        // User session from cookies (same-origin request)\n        const serverSupabase = await (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_2__.createClient)();\n        const { data: { user } } = await serverSupabase.auth.getUser();\n        let submission = null;\n        let clientId = null;\n        let stripeCustomerId = null;\n        let accountCreated = false;\n        // Retry payment: existing submission\n        if (submissionId) {\n            const { data: existingSubmission, error: fetchError } = await supabase.from(\"submission\").select(\"*\").eq(\"id\", submissionId).single();\n            if (fetchError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Failed to fetch submission: \" + fetchError.message\n                }, {\n                    status: 400\n                });\n            }\n            submission = existingSubmission;\n            clientId = existingSubmission.client_id;\n        } else if (formData.sessionId) {\n            const { data: existingSubmissions } = await supabase.from(\"submission\").select(\"*\").in(\"status\", [\n                \"pending\",\n                \"pending_payment\",\n                \"confirmed\"\n            ]).order(\"created_at\", {\n                ascending: false\n            }).limit(20);\n            const found = (existingSubmissions || []).find((s)=>s.data?.session_id === formData.sessionId);\n            if (found) {\n                submission = found;\n                clientId = found.client_id;\n                submissionId = found.id;\n            }\n        }\n        // Récupérer stripe_customer_id du client quand on a une submission existante (retry/resume)\n        if (clientId && !stripeCustomerId) {\n            const { data: clientRow } = await supabase.from(\"client\").select(\"stripe_customer_id\").eq(\"id\", clientId).single();\n            if (clientRow) {\n                stripeCustomerId = clientRow.stripe_customer_id;\n            }\n        }\n        // Update existing submission with latest data (when found by session_id or retry)\n        if (submission && submissionId) {\n            const submissionData = {\n                client_id: clientId,\n                status: \"pending_payment\",\n                first_name: formData.firstName,\n                last_name: formData.lastName,\n                email: formData.email,\n                phone: formData.phone || \"\",\n                address: formData.address,\n                city: formData.city,\n                postal_code: formData.postalCode,\n                country: formData.country,\n                notes: formData.notes ?? null,\n                gclid: formData.gclid ?? null,\n                appointment_date: formData.appointmentDate,\n                appointment_time: formData.appointmentTime,\n                timezone: formData.timezone,\n                data: {\n                    session_id: formData.sessionId ?? null,\n                    selectedServices: formData.selectedServices,\n                    serviceDocuments: formData.serviceDocuments,\n                    signatories: formData.signatories || [],\n                    signatoriesCount: formData.signatoriesCount || 0,\n                    additionalSignatoriesCount: formData.additionalSignatoriesCount || 0,\n                    signatoryCount: formData.signatoryCount ?? formData.signatoriesCount ?? null,\n                    currency\n                }\n            };\n            const { data: updated, error: updateErr } = await supabase.from(\"submission\").update(submissionData).eq(\"id\", submissionId).select().single();\n            if (!updateErr && updated) submission = updated;\n        }\n        if (!submission) {\n            let userId = user?.id ?? null;\n            if (!userId && formData.email) {\n                const { data: { users } } = await supabase.auth.admin.listUsers();\n                const existingUser = users?.find((u)=>u.email === formData.email);\n                if (existingUser) {\n                    userId = existingUser.id;\n                } else {\n                    const password = formData.password || crypto.randomUUID();\n                    const { data: authData, error: authError } = await supabase.auth.admin.createUser({\n                        email: formData.email,\n                        password,\n                        email_confirm: true,\n                        user_metadata: {\n                            first_name: formData.firstName,\n                            last_name: formData.lastName\n                        }\n                    });\n                    if (authError) throw new Error(\"Failed to create account: \" + authError.message);\n                    if (authData.user) {\n                        userId = authData.user.id;\n                        accountCreated = true;\n                    }\n                }\n            }\n            if (userId) {\n                const { data: existingClient } = await supabase.from(\"client\").select(\"id, stripe_customer_id\").eq(\"user_id\", userId).maybeSingle();\n                if (existingClient) {\n                    clientId = existingClient.id;\n                    stripeCustomerId = existingClient.stripe_customer_id;\n                } else {\n                    const clientEmail = email || user?.email;\n                    if (!clientEmail) throw new Error(\"Email is required to create client account\");\n                    const { data: newClient, error: clientError } = await supabase.from(\"client\").insert([\n                        {\n                            user_id: userId,\n                            first_name: firstName,\n                            last_name: lastName,\n                            email: clientEmail,\n                            phone: formData.phone || \"\",\n                            address: formData.address || \"\",\n                            city: formData.city || \"\",\n                            postal_code: formData.postalCode || \"\",\n                            country: formData.country || \"\"\n                        }\n                    ]).select(\"id\").single();\n                    if (!clientError && newClient) clientId = newClient.id;\n                }\n            }\n            if (clientId && !stripeCustomerId) {\n                const clientEmail = email || user?.email;\n                const clientName = `${firstName} ${lastName}`.trim();\n                // Ne créer le client Stripe que si on a un nom valide (jamais en tant qu'invité)\n                if (clientName) {\n                    try {\n                        const customer = await stripe.customers.create({\n                            email: clientEmail,\n                            name: clientName,\n                            phone: formData.phone || undefined,\n                            metadata: {\n                                client_id: clientId,\n                                user_id: userId || \"\"\n                            }\n                        });\n                        stripeCustomerId = customer.id;\n                        await supabase.from(\"client\").update({\n                            stripe_customer_id: stripeCustomerId\n                        }).eq(\"id\", clientId);\n                    } catch  {\n                    // Continue without Stripe customer, use customer_email instead\n                    }\n                }\n            }\n            if (submissionId && submission) {\n                const sub = submission;\n                if (!body.currency && sub.data?.currency) {\n                    currency = (sub.data.currency || \"EUR\").toUpperCase();\n                }\n            }\n            const submissionData = {\n                client_id: clientId,\n                status: \"pending_payment\",\n                first_name: formData.firstName,\n                last_name: formData.lastName,\n                email: formData.email,\n                phone: formData.phone || \"\",\n                address: formData.address,\n                city: formData.city,\n                postal_code: formData.postalCode,\n                country: formData.country,\n                notes: formData.notes ?? null,\n                gclid: formData.gclid ?? null,\n                appointment_date: formData.appointmentDate,\n                appointment_time: formData.appointmentTime,\n                timezone: formData.timezone,\n                data: {\n                    session_id: formData.sessionId ?? null,\n                    selectedServices: formData.selectedServices,\n                    serviceDocuments: formData.serviceDocuments,\n                    signatories: formData.signatories || [],\n                    signatoriesCount: formData.signatoriesCount || 0,\n                    additionalSignatoriesCount: formData.additionalSignatoriesCount || 0,\n                    signatoryCount: formData.signatoryCount ?? formData.signatoriesCount ?? null,\n                    currency\n                }\n            };\n            const { data: newSubmission, error: submissionError } = await supabase.from(\"submission\").insert([\n                submissionData\n            ]).select().single();\n            if (submissionError) throw new Error(\"Failed to create submission: \" + submissionError.message);\n            submission = newSubmission;\n            submissionId = newSubmission.id;\n        }\n        if (submissionId && submission) {\n            const sub = submission;\n            if (!body.currency && sub.data?.currency) {\n                currency = (sub.data.currency || \"EUR\").toUpperCase();\n            }\n        }\n        const { data: services, error: servicesError } = await supabase.from(\"services\").select(\"*\").eq(\"is_active\", true);\n        if (servicesError) throw new Error(\"Failed to fetch services: \" + servicesError.message);\n        const servicesMap = {};\n        (services || []).forEach((s)=>{\n            servicesMap[s.service_id] = {\n                name: s.name,\n                base_price: s.base_price,\n                price_usd: s.price_usd,\n                price_gbp: s.price_gbp\n            };\n        });\n        const { data: options } = await supabase.from(\"options\").select(\"*\").eq(\"is_active\", true);\n        const optionsMap = {};\n        (options || []).forEach((o)=>{\n            optionsMap[o.option_id] = {\n                name: o.name,\n                additional_price: o.additional_price,\n                price_usd: o.price_usd,\n                price_gbp: o.price_gbp\n            };\n        });\n        function getServicePriceForStripe(service, curr) {\n            if (curr === \"USD\" && service.price_usd != null) return service.price_usd;\n            if (curr === \"GBP\" && service.price_gbp != null) return service.price_gbp;\n            return convertPriceToMatchClient(service.base_price ?? 0, curr);\n        }\n        function getOptionPriceForStripe(option, curr) {\n            if (curr === \"USD\" && option.price_usd != null) return option.price_usd;\n            if (curr === \"GBP\" && option.price_gbp != null) return option.price_gbp;\n            return convertPriceToMatchClient(option.additional_price ?? 0, curr);\n        }\n        const lineItems = [];\n        const optionCounts = {};\n        const selectedServices = formData.selectedServices || [];\n        const serviceDocuments = formData.serviceDocuments || {};\n        for (const serviceId of selectedServices){\n            const service = servicesMap[serviceId];\n            if (!service) continue;\n            const docs = serviceDocuments[serviceId] || [];\n            const documentCount = docs.length;\n            if (documentCount === 0) continue;\n            const priceInCurrency = getServicePriceForStripe(service, currency);\n            const unitAmount = currency === \"JPY\" ? Math.round(priceInCurrency) : Math.round(priceInCurrency * 100);\n            lineItems.push({\n                price_data: {\n                    currency: stripeCurrency,\n                    product_data: {\n                        name: `${service.name} (${documentCount} document${documentCount > 1 ? \"s\" : \"\"})`\n                    },\n                    unit_amount: unitAmount\n                },\n                quantity: documentCount\n            });\n            for (const doc of docs){\n                let optionsArray = [];\n                const opts = doc.selectedOptions;\n                if (opts) {\n                    if (Array.isArray(opts)) optionsArray = opts;\n                    else if (typeof opts === \"string\") {\n                        try {\n                            const parsed = JSON.parse(opts);\n                            optionsArray = Array.isArray(parsed) ? parsed : [\n                                opts\n                            ];\n                        } catch  {\n                            optionsArray = [\n                                opts\n                            ];\n                        }\n                    } else {\n                        optionsArray = [\n                            opts\n                        ];\n                    }\n                }\n                optionsArray.forEach((optId)=>{\n                    optionCounts[optId] = (optionCounts[optId] || 0) + 1;\n                });\n            }\n        }\n        for (const [optionId, count] of Object.entries(optionCounts)){\n            const option = optionsMap[optionId];\n            if (!option) continue;\n            const priceInCurrency = getOptionPriceForStripe(option, currency);\n            if (priceInCurrency <= 0) continue;\n            const unitAmount = currency === \"JPY\" ? Math.round(priceInCurrency) : Math.round(priceInCurrency * 100);\n            lineItems.push({\n                price_data: {\n                    currency: stripeCurrency,\n                    product_data: {\n                        name: `${option.name} (${count} document${count > 1 ? \"s\" : \"\"})`\n                    },\n                    unit_amount: unitAmount\n                },\n                quantity: count\n            });\n        }\n        const deliveryMethod = formData.deliveryMethod || \"email\";\n        const deliveryPostalCostEUR = formData.deliveryPostalCostEUR || 0;\n        if (deliveryMethod === \"postal\" && deliveryPostalCostEUR > 0) {\n            const deliveryCostInCurrency = convertPriceToMatchClient(deliveryPostalCostEUR, currency);\n            const unitAmount = currency === \"JPY\" ? Math.round(deliveryCostInCurrency) : Math.round(deliveryCostInCurrency * 100);\n            lineItems.push({\n                price_data: {\n                    currency: stripeCurrency,\n                    product_data: {\n                        name: \"Physical Delivery (DHL Express)\",\n                        description: `Postal delivery via DHL Express (${deliveryPostalCostEUR} EUR)`\n                    },\n                    unit_amount: unitAmount\n                },\n                quantity: 1\n            });\n        }\n        const additionalSignatoriesCount = formData.additionalSignatoriesCount || 0;\n        const additionalSignatoriesCostEUR = formData.additionalSignatoriesCost || 0;\n        if (additionalSignatoriesCount > 0 && additionalSignatoriesCostEUR > 0) {\n            const cost = convertPriceToMatchClient(additionalSignatoriesCostEUR, currency);\n            const unitPrice = cost / additionalSignatoriesCount;\n            const unitAmount = currency === \"JPY\" ? Math.round(unitPrice) : Math.round(unitPrice * 100);\n            lineItems.push({\n                price_data: {\n                    currency: stripeCurrency,\n                    product_data: {\n                        name: `Additional Signatories (${additionalSignatoriesCount} signatory${additionalSignatoriesCount > 1 ? \"ies\" : \"\"})`,\n                        description: `Additional signatories: ${additionalSignatoriesCount} × 45€`\n                    },\n                    unit_amount: unitAmount\n                },\n                quantity: additionalSignatoriesCount\n            });\n        }\n        if (lineItems.length === 0) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"No valid services with documents selected\"\n            }, {\n                status: 400\n            });\n        }\n        const origin = request.headers.get(\"origin\") || request.nextUrl.origin || \"https://app.mynotary.io\";\n        const sessionParams = {\n            payment_method_types: [\n                \"card\"\n            ],\n            line_items: lineItems,\n            mode: \"payment\",\n            success_url: `${origin}/payment/success?session_id={CHECKOUT_SESSION_ID}`,\n            cancel_url: `${origin}/payment/failed`,\n            metadata: {\n                submission_id: submissionId,\n                client_id: clientId ?? \"\",\n                account_created: accountCreated ? \"true\" : \"false\"\n            }\n        };\n        let promoCodeApplied = false;\n        if (promoCodeId) {\n            try {\n                const promotionCode = await stripe.promotionCodes.retrieve(promoCodeId);\n                if (promotionCode.active && promotionCode.coupon?.valid) {\n                    const canRedeem = !promotionCode.max_redemptions || !promotionCode.times_redeemed || promotionCode.times_redeemed < promotionCode.max_redemptions;\n                    if (canRedeem) {\n                        sessionParams.discounts = [\n                            {\n                                promotion_code: String(promoCodeId)\n                            }\n                        ];\n                        promoCodeApplied = true;\n                    }\n                }\n            } catch  {\n            // Fall through to search by code\n            }\n        }\n        if (!promoCodeApplied && promoCode) {\n            const promoCodeUpper = String(promoCode).toUpperCase().trim();\n            try {\n                const { data: promotionCodes } = await stripe.promotionCodes.list({\n                    code: promoCodeUpper,\n                    limit: 1,\n                    active: true\n                });\n                const pc = promotionCodes[0];\n                if (pc && pc.active && pc.coupon?.valid) {\n                    const canRedeem = !pc.max_redemptions || !pc.times_redeemed || pc.times_redeemed < pc.max_redemptions;\n                    if (canRedeem) {\n                        sessionParams.discounts = [\n                            {\n                                promotion_code: String(pc.id)\n                            }\n                        ];\n                        promoCodeApplied = true;\n                    }\n                }\n            } catch  {\n            // Ignore\n            }\n        }\n        if (!promoCodeApplied) {\n            sessionParams.allow_promotion_codes = true;\n        }\n        if (stripeCustomerId) {\n            sessionParams.customer = stripeCustomerId;\n            sessionParams.payment_method_options = {\n                card: {\n                    setup_future_usage: \"off_session\"\n                }\n            };\n        } else {\n            sessionParams.customer_email = formData.email || user?.email;\n            sessionParams.payment_method_options = {\n                card: {\n                    setup_future_usage: \"off_session\"\n                }\n            };\n        }\n        const session = await stripe.checkout.sessions.create(sessionParams);\n        if (submissionId) {\n            const { data: existingSub } = await supabase.from(\"submission\").select(\"funnel_status\").eq(\"id\", submissionId).single();\n            const orderMap = {\n                started: 1,\n                services_selected: 2,\n                documents_uploaded: 3,\n                delivery_method_selected: 4,\n                personal_info_completed: 5,\n                summary_viewed: 6,\n                payment_pending: 7,\n                payment_completed: 8,\n                submission_completed: 9\n            };\n            const currentOrder = orderMap[existingSub?.funnel_status || \"\"] || 0;\n            if (7 > currentOrder) {\n                await supabase.from(\"submission\").update({\n                    funnel_status: \"payment_pending\"\n                }).eq(\"id\", submissionId);\n            }\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            url: session.url,\n            submissionId\n        });\n    } catch (error) {\n        console.error(\"[create-checkout-session]\", error);\n        const message = error instanceof Error ? error.message : \"Payment failed\";\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: message\n        }, {\n            status: 400\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2NyZWF0ZS1jaGVja291dC1zZXNzaW9uL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7OztDQUdDLEdBRXVEO0FBQzVCO0FBRStDO0FBQ2xCO0FBRXpELHNGQUFzRjtBQUN0RixNQUFNSyx3QkFBZ0Q7SUFDcERDLEtBQUs7SUFDTEMsS0FBSztJQUNMQyxLQUFLO0lBQ0xDLEtBQUs7SUFDTEMsS0FBSztJQUNMQyxLQUFLO0lBQ0xDLEtBQUs7QUFDUDtBQUVBLFNBQVNDLDBCQUEwQkMsU0FBaUIsRUFBRUMsY0FBc0I7SUFDMUUsSUFBSSxDQUFDRCxhQUFhLENBQUNDLGtCQUFrQkEsZUFBZUMsV0FBVyxPQUFPLE9BQU8sT0FBT0Y7SUFDcEYsTUFBTUcsT0FBT1oscUJBQXFCLENBQUNVLGVBQWVDLFdBQVcsR0FBRyxJQUFJO0lBQ3BFLElBQUlELGVBQWVDLFdBQVcsT0FBTyxPQUFPLE9BQU9FLEtBQUtDLEtBQUssQ0FBQ0wsWUFBWUc7SUFDMUUsT0FBT0MsS0FBS0MsS0FBSyxDQUFDTCxZQUFZRyxPQUFPLE9BQU87QUFDOUM7QUFFTyxlQUFlRyxLQUFLQyxPQUFvQjtJQUM3QyxJQUFJQyxXQUEyQztJQUMvQyxJQUFJQztJQUVKLElBQUk7UUFDRixNQUFNQyxPQUFPLE1BQU1ILFFBQVFJLElBQUk7UUFDL0JILFdBQVdFLEtBQUtGLFFBQVE7UUFDeEJDLGVBQWVDLEtBQUtELFlBQVk7UUFFaEMsSUFBSSxDQUFDRCxVQUFVO1lBQ2IsT0FBT3RCLHFEQUFZQSxDQUFDeUIsSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztZQUFtQyxHQUM1QztnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsd0VBQXdFO1FBQ3hFLE1BQU1DLFFBQVNOLFNBQVNNLEtBQUssRUFBYUM7UUFDMUMsTUFBTUMsWUFBYVIsU0FBU1EsU0FBUyxFQUFhRDtRQUNsRCxNQUFNRSxXQUFZVCxTQUFTUyxRQUFRLEVBQWFGO1FBQ2hELElBQUksQ0FBQ0QsU0FBUyxDQUFD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QyxnQkFBZ0I7Z0JBQ2hCQyxpQkFBaUI7Z0JBQ2pCQyxtQkFBbUI7Z0JBQ25CQyxzQkFBc0I7WUFDeEI7WUFDQSxNQUFNQyxlQUNKVixRQUFRLENBQUMsYUFBNENXLGlCQUFpQixHQUFHLElBQUk7WUFDL0UsSUFBSSxJQUFJRCxjQUFjO2dCQUNwQixNQUFNbE0sU0FDSGlCLElBQUksQ0FBQyxjQUNMMkMsTUFBTSxDQUFDO29CQUFFdUksZUFBZTtnQkFBa0IsR0FDMUNoTCxFQUFFLENBQUMsTUFBTXhDO1lBQ2Q7UUFDRjtRQUVBLE9BQU92QixxREFBWUEsQ0FBQ3lCLElBQUksQ0FBQztZQUN2QnVOLEtBQUtoQixRQUFRZ0IsR0FBRztZQUNoQnpOO1FBQ0Y7SUFDRixFQUFFLE9BQU9HLE9BQU87UUFDZHVOLFFBQVF2TixLQUFLLENBQUMsNkJBQTZCQTtRQUMzQyxNQUFNdUMsVUFDSnZDLGlCQUFpQjZGLFFBQVE3RixNQUFNdUMsT0FBTyxHQUFHO1FBQzNDLE9BQU9qRSxxREFBWUEsQ0FBQ3lCLElBQUksQ0FBQztZQUFFQyxPQUFPdUM7UUFBUSxHQUFHO1lBQUV0QyxRQUFRO1FBQUk7SUFDN0Q7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2NsaWVudC1kYXNoYm9hcmQvLi9hcHAvYXBpL2NyZWF0ZS1jaGVja291dC1zZXNzaW9uL3JvdXRlLnRzP2Y2YTciXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEFQSSByb3V0ZSB0byBjcmVhdGUgU3RyaXBlIGNoZWNrb3V0IHNlc3Npb24uXHJcbiAqIEZ1bGwgaW1wbGVtZW50YXRpb24gKG5vIEVkZ2UgRnVuY3Rpb24pIC0gdXNlcyBTdHJpcGUgKyBTdXBhYmFzZSBkaXJlY3RseS5cclxuICovXHJcblxyXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcbmltcG9ydCBTdHJpcGUgZnJvbSBcInN0cmlwZVwiO1xyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCI7XHJcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCBhcyBjcmVhdGVTZXJ2ZXJDbGllbnQgfSBmcm9tIFwiQC9saWIvc3VwYWJhc2Uvc2VydmVyXCI7XHJcbmltcG9ydCB7IGNyZWF0ZUFkbWluQ2xpZW50IH0gZnJvbSBcIkAvbGliL3N1cGFiYXNlL2FkbWluXCI7XHJcblxyXG4vLyBUYXV4IGlkZW50aXF1ZXMgYXUgY2xpZW50IChsaWIvdXRpbHMvY3VycmVuY3kudHMpIHBvdXIgY29ow6lyZW5jZSBTdW1tYXJ5IDwtPiBTdHJpcGVcclxuY29uc3QgQ0xJRU5UX0ZBTExCQUNLX1JBVEVTOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge1xyXG4gIFVTRDogMS4xLFxyXG4gIEdCUDogMC44NSxcclxuICBDQUQ6IDEuNSxcclxuICBBVUQ6IDEuNjUsXHJcbiAgQ0hGOiAwLjk1LFxyXG4gIEpQWTogMTY1LFxyXG4gIENOWTogNy44LFxyXG59O1xyXG5cclxuZnVuY3Rpb24gY29udmVydFByaWNlVG9NYXRjaENsaWVudChldXJBbW91bnQ6IG51bWJlciwgdGFyZ2V0Q3VycmVuY3k6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgaWYgKCFldXJBbW91bnQgfHwgIXRhcmdldEN1cnJlbmN5IHx8IHRhcmdldEN1cnJlbmN5LnRvVXBwZXJDYXNlKCkgPT09IFwiRVVSXCIpIHJldHVybiBldXJBbW91bnQ7XHJcbiAgY29uc3QgcmF0ZSA9IENMSUVOVF9GQUxMQkFDS19SQVRFU1t0YXJnZXRDdXJyZW5jeS50b1VwcGVyQ2FzZSgpXSA/PyAxO1xyXG4gIGlmICh0YXJnZXRDdXJyZW5jeS50b1VwcGVyQ2FzZSgpID09PSBcIkpQWVwiKSByZXR1cm4gTWF0aC5yb3VuZChldXJBbW91bnQgKiByYXRlKTtcclxuICByZXR1cm4gTWF0aC5yb3VuZChldXJBbW91bnQgKiByYXRlICogMTAwKSAvIDEwMDtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICBsZXQgZm9ybURhdGE6IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHwgbnVsbCA9IG51bGw7XHJcbiAgbGV0IHN1Ym1pc3Npb25JZDogc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xyXG4gICAgZm9ybURhdGEgPSBib2R5LmZvcm1EYXRhO1xyXG4gICAgc3VibWlzc2lvbklkID0gYm9keS5zdWJtaXNzaW9uSWQ7XHJcblxyXG4gICAgaWYgKCFmb3JtRGF0YSkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogXCJNaXNzaW5nIHJlcXVpcmVkIGZpZWxkOiBmb3JtRGF0YVwiIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRXhpZ2VyIGxlcyBkb25uw6llcyBjbGllbnQgcsOpZWxsZXMgKHBhcyBkZSBjcsOpYXRpb24gZW4gdGFudCBxdSdpbnZpdMOpKVxyXG4gICAgY29uc3QgZW1haWwgPSAoZm9ybURhdGEuZW1haWwgYXMgc3RyaW5nKT8udHJpbSgpO1xyXG4gICAgY29uc3QgZmlyc3ROYW1lID0gKGZvcm1EYXRhLmZpcnN0TmFtZSBhcyBzdHJpbmcpPy50cmltKCk7XHJcbiAgICBjb25zdCBsYXN0TmFtZSA9IChmb3JtRGF0YS5sYXN0TmFtZSBhcyBzdHJpbmcpPy50cmltKCk7XHJcbiAgICBpZiAoIWVtYWlsIHx8ICFmaXJzdE5hbWUgfHwgIWxhc3ROYW1lKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7XHJcbiAgICAgICAgICBlcnJvcjpcclxuICAgICAgICAgICAgXCJFbWFpbCwgZmlyc3QgbmFtZSBhbmQgbGFzdCBuYW1lIGFyZSByZXF1aXJlZCB0byBjcmVhdGUgYSBjbGllbnQgYWNjb3VudFwiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3RyaXBlU2VjcmV0S2V5ID0gcHJvY2Vzcy5lbnYuU1RSSVBFX1NFQ1JFVF9LRVk7XHJcbiAgICBjb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcclxuICAgIGNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZO1xyXG4gICAgY29uc3Qgc3VwYWJhc2VTZXJ2aWNlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWTtcclxuXHJcbiAgICBpZiAoIXN0cmlwZVNlY3JldEtleSB8fCAhc3VwYWJhc2VVcmwgfHwgIXN1cGFiYXNlU2VydmljZUtleSkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgZXJyb3I6XHJcbiAgICAgICAgICAgIFwiTWlzc2luZyBTVFJJUEVfU0VDUkVUX0tFWSwgU1VQQUJBU0VfVVJMIG9yIFNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVlcIixcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0cmlwZSA9IG5ldyBTdHJpcGUoc3RyaXBlU2VjcmV0S2V5LCB7XHJcbiAgICAgIGFwaVZlcnNpb246IFwiMjAyMy0xMC0xNlwiLFxyXG4gICAgfSk7XHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUFkbWluQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IGN1cnJlbmN5ID0gKFxyXG4gICAgICBib2R5LmN1cnJlbmN5IHx8XHJcbiAgICAgIChmb3JtRGF0YS5jdXJyZW5jeSBhcyBzdHJpbmcpIHx8XHJcbiAgICAgIFwiRVVSXCJcclxuICAgICkudG9VcHBlckNhc2UoKTtcclxuICAgIGNvbnN0IHN0cmlwZUN1cnJlbmN5ID0gY3VycmVuY3kudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgICBjb25zdCBwcm9tb0NvZGUgPSAoYm9keS5wcm9tb0NvZGUgfHwgZm9ybURhdGEucHJvbW9Db2RlKSBhcyBzdHJpbmcgfCBudWxsO1xyXG4gICAgY29uc3QgcHJvbW9Db2RlSWQgPSAoYm9keS5wcm9tb0NvZGVJZCB8fCBmb3JtRGF0YS5wcm9tb0NvZGVJZCkgYXNcclxuICAgICAgfCBzdHJpbmdcclxuICAgICAgfCBudWxsO1xyXG5cclxuICAgIC8vIFVzZXIgc2Vzc2lvbiBmcm9tIGNvb2tpZXMgKHNhbWUtb3JpZ2luIHJlcXVlc3QpXHJcbiAgICBjb25zdCBzZXJ2ZXJTdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZVNlcnZlckNsaWVudCgpO1xyXG4gICAgY29uc3Qge1xyXG4gICAgICBkYXRhOiB7IHVzZXIgfSxcclxuICAgIH0gPSBhd2FpdCBzZXJ2ZXJTdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcclxuXHJcbiAgICBsZXQgc3VibWlzc2lvbjogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gfCBudWxsID0gbnVsbDtcclxuICAgIGxldCBjbGllbnRJZDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgICBsZXQgc3RyaXBlQ3VzdG9tZXJJZDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgICBsZXQgYWNjb3VudENyZWF0ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBSZXRyeSBwYXltZW50OiBleGlzdGluZyBzdWJtaXNzaW9uXHJcbiAgICBpZiAoc3VibWlzc2lvbklkKSB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdTdWJtaXNzaW9uLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbShcInN1Ym1pc3Npb25cIilcclxuICAgICAgICAuc2VsZWN0KFwiKlwiKVxyXG4gICAgICAgIC5lcShcImlkXCIsIHN1Ym1pc3Npb25JZClcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoZmV0Y2hFcnJvcikge1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICAgIHsgZXJyb3I6IFwiRmFpbGVkIHRvIGZldGNoIHN1Ym1pc3Npb246IFwiICsgZmV0Y2hFcnJvci5tZXNzYWdlIH0sXHJcbiAgICAgICAgICB7IHN0YXR1czogNDAwIH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIHN1Ym1pc3Npb24gPSBleGlzdGluZ1N1Ym1pc3Npb24gYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XHJcbiAgICAgIGNsaWVudElkID0gKGV4aXN0aW5nU3VibWlzc2lvbiBhcyB7IGNsaWVudF9pZDogc3RyaW5nIH0pLmNsaWVudF9pZDtcclxuICAgIH0gZWxzZSBpZiAoKGZvcm1EYXRhLnNlc3Npb25JZCBhcyBzdHJpbmcpKSB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdTdWJtaXNzaW9ucyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbShcInN1Ym1pc3Npb25cIilcclxuICAgICAgICAuc2VsZWN0KFwiKlwiKVxyXG4gICAgICAgIC5pbihcInN0YXR1c1wiLCBbXCJwZW5kaW5nXCIsIFwicGVuZGluZ19wYXltZW50XCIsIFwiY29uZmlybWVkXCJdKVxyXG4gICAgICAgIC5vcmRlcihcImNyZWF0ZWRfYXRcIiwgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXHJcbiAgICAgICAgLmxpbWl0KDIwKTtcclxuXHJcbiAgICAgIGNvbnN0IGZvdW5kID0gKGV4aXN0aW5nU3VibWlzc2lvbnMgfHwgW10pLmZpbmQoXHJcbiAgICAgICAgKHM6IHsgZGF0YT86IHsgc2Vzc2lvbl9pZD86IHN0cmluZyB9IH0pID0+XHJcbiAgICAgICAgICBzLmRhdGE/LnNlc3Npb25faWQgPT09IGZvcm1EYXRhLnNlc3Npb25JZFxyXG4gICAgICApO1xyXG4gICAgICBpZiAoZm91bmQpIHtcclxuICAgICAgICBzdWJtaXNzaW9uID0gZm91bmQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XHJcbiAgICAgICAgY2xpZW50SWQgPSAoZm91bmQgYXMgeyBjbGllbnRfaWQ6IHN0cmluZyB9KS5jbGllbnRfaWQ7XHJcbiAgICAgICAgc3VibWlzc2lvbklkID0gKGZvdW5kIGFzIHsgaWQ6IHN0cmluZyB9KS5pZDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFLDqWN1cMOpcmVyIHN0cmlwZV9jdXN0b21lcl9pZCBkdSBjbGllbnQgcXVhbmQgb24gYSB1bmUgc3VibWlzc2lvbiBleGlzdGFudGUgKHJldHJ5L3Jlc3VtZSlcclxuICAgIGlmIChjbGllbnRJZCAmJiAhc3RyaXBlQ3VzdG9tZXJJZCkge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGNsaWVudFJvdyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbShcImNsaWVudFwiKVxyXG4gICAgICAgIC5zZWxlY3QoXCJzdHJpcGVfY3VzdG9tZXJfaWRcIilcclxuICAgICAgICAuZXEoXCJpZFwiLCBjbGllbnRJZClcclxuICAgICAgICAuc2luZ2xlKCk7XHJcbiAgICAgIGlmIChjbGllbnRSb3cpIHtcclxuICAgICAgICBzdHJpcGVDdXN0b21lcklkID0gKGNsaWVudFJvdyBhcyB7IHN0cmlwZV9jdXN0b21lcl9pZDogc3RyaW5nIHwgbnVsbCB9KS5zdHJpcGVfY3VzdG9tZXJfaWQ7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBVcGRhdGUgZXhpc3Rpbmcgc3VibWlzc2lvbiB3aXRoIGxhdGVzdCBkYXRhICh3aGVuIGZvdW5kIGJ5IHNlc3Npb25faWQgb3IgcmV0cnkpXHJcbiAgICBpZiAoc3VibWlzc2lvbiAmJiBzdWJtaXNzaW9uSWQpIHtcclxuICAgICAgY29uc3Qgc3VibWlzc2lvbkRhdGEgPSB7XHJcbiAgICAgICAgY2xpZW50X2lkOiBjbGllbnRJZCxcclxuICAgICAgICBzdGF0dXM6IFwicGVuZGluZ19wYXltZW50XCIsXHJcbiAgICAgICAgZmlyc3RfbmFtZTogZm9ybURhdGEuZmlyc3ROYW1lLFxyXG4gICAgICAgIGxhc3RfbmFtZTogZm9ybURhdGEubGFzdE5hbWUsXHJcbiAgICAgICAgZW1haWw6IGZvcm1EYXRhLmVtYWlsLFxyXG4gICAgICAgIHBob25lOiBmb3JtRGF0YS5waG9uZSB8fCBcIlwiLFxyXG4gICAgICAgIGFkZHJlc3M6IGZvcm1EYXRhLmFkZHJlc3MsXHJcbiAgICAgICAgY2l0eTogZm9ybURhdGEuY2l0eSxcclxuICAgICAgICBwb3N0YWxfY29kZTogZm9ybURhdGEucG9zdGFsQ29kZSxcclxuICAgICAgICBjb3VudHJ5OiBmb3JtRGF0YS5jb3VudHJ5LFxyXG4gICAgICAgIG5vdGVzOiBmb3JtRGF0YS5ub3RlcyA/PyBudWxsLFxyXG4gICAgICAgIGdjbGlkOiBmb3JtRGF0YS5nY2xpZCA/PyBudWxsLFxyXG4gICAgICAgIGFwcG9pbnRtZW50X2RhdGU6IGZvcm1EYXRhLmFwcG9pbnRtZW50RGF0ZSxcclxuICAgICAgICBhcHBvaW50bWVudF90aW1lOiBmb3JtRGF0YS5hcHBvaW50bWVudFRpbWUsXHJcbiAgICAgICAgdGltZXpvbmU6IGZvcm1EYXRhLnRpbWV6b25lLFxyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgIHNlc3Npb25faWQ6IGZvcm1EYXRhLnNlc3Npb25JZCA/PyBudWxsLFxyXG4gICAgICAgICAgc2VsZWN0ZWRTZXJ2aWNlczogZm9ybURhdGEuc2VsZWN0ZWRTZXJ2aWNlcyxcclxuICAgICAgICAgIHNlcnZpY2VEb2N1bWVudHM6IGZvcm1EYXRhLnNlcnZpY2VEb2N1bWVudHMsXHJcbiAgICAgICAgICBzaWduYXRvcmllczogZm9ybURhdGEuc2lnbmF0b3JpZXMgfHwgW10sXHJcbiAgICAgICAgICBzaWduYXRvcmllc0NvdW50OiBmb3JtRGF0YS5zaWduYXRvcmllc0NvdW50IHx8IDAsXHJcbiAgICAgICAgICBhZGRpdGlvbmFsU2lnbmF0b3JpZXNDb3VudDogZm9ybURhdGEuYWRkaXRpb25hbFNpZ25hdG9yaWVzQ291bnQgfHwgMCxcclxuICAgICAgICAgIHNpZ25hdG9yeUNvdW50OiBmb3JtRGF0YS5zaWduYXRvcnlDb3VudCA/PyBmb3JtRGF0YS5zaWduYXRvcmllc0NvdW50ID8/IG51bGwsXHJcbiAgICAgICAgICBjdXJyZW5jeSxcclxuICAgICAgICB9LFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnIgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oXCJzdWJtaXNzaW9uXCIpXHJcbiAgICAgICAgLnVwZGF0ZShzdWJtaXNzaW9uRGF0YSlcclxuICAgICAgICAuZXEoXCJpZFwiLCBzdWJtaXNzaW9uSWQpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICBpZiAoIXVwZGF0ZUVyciAmJiB1cGRhdGVkKSBzdWJtaXNzaW9uID0gdXBkYXRlZCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXN1Ym1pc3Npb24pIHtcclxuICAgICAgbGV0IHVzZXJJZCA9IHVzZXI/LmlkID8/IG51bGw7XHJcblxyXG4gICAgICBpZiAoIXVzZXJJZCAmJiBmb3JtRGF0YS5lbWFpbCkge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogeyB1c2VycyB9IH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmFkbWluLmxpc3RVc2VycygpO1xyXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IHVzZXJzPy5maW5kKFxyXG4gICAgICAgICAgKHUpID0+IHUuZW1haWwgPT09IChmb3JtRGF0YS5lbWFpbCBhcyBzdHJpbmcpXHJcbiAgICAgICAgKTtcclxuICAgICAgICBpZiAoZXhpc3RpbmdVc2VyKSB7XHJcbiAgICAgICAgICB1c2VySWQgPSBleGlzdGluZ1VzZXIuaWQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbnN0IHBhc3N3b3JkID1cclxuICAgICAgICAgICAgKGZvcm1EYXRhLnBhc3N3b3JkIGFzIHN0cmluZykgfHwgY3J5cHRvLnJhbmRvbVVVSUQoKTtcclxuICAgICAgICAgIGNvbnN0IHsgZGF0YTogYXV0aERhdGEsIGVycm9yOiBhdXRoRXJyb3IgfSA9XHJcbiAgICAgICAgICAgIGF3YWl0IHN1cGFiYXNlLmF1dGguYWRtaW4uY3JlYXRlVXNlcih7XHJcbiAgICAgICAgICAgICAgZW1haWw6IGZvcm1EYXRhLmVtYWlsIGFzIHN0cmluZyxcclxuICAgICAgICAgICAgICBwYXNzd29yZCxcclxuICAgICAgICAgICAgICBlbWFpbF9jb25maXJtOiB0cnVlLFxyXG4gICAgICAgICAgICAgIHVzZXJfbWV0YWRhdGE6IHtcclxuICAgICAgICAgICAgICAgIGZpcnN0X25hbWU6IGZvcm1EYXRhLmZpcnN0TmFtZSxcclxuICAgICAgICAgICAgICAgIGxhc3RfbmFtZTogZm9ybURhdGEubGFzdE5hbWUsXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICBpZiAoYXV0aEVycm9yKVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIGFjY291bnQ6IFwiICsgYXV0aEVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgaWYgKGF1dGhEYXRhLnVzZXIpIHtcclxuICAgICAgICAgICAgdXNlcklkID0gYXV0aERhdGEudXNlci5pZDtcclxuICAgICAgICAgICAgYWNjb3VudENyZWF0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHVzZXJJZCkge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdDbGllbnQgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbShcImNsaWVudFwiKVxyXG4gICAgICAgICAgLnNlbGVjdChcImlkLCBzdHJpcGVfY3VzdG9tZXJfaWRcIilcclxuICAgICAgICAgIC5lcShcInVzZXJfaWRcIiwgdXNlcklkKVxyXG4gICAgICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmIChleGlzdGluZ0NsaWVudCkge1xyXG4gICAgICAgICAgY2xpZW50SWQgPSAoZXhpc3RpbmdDbGllbnQgYXMgeyBpZDogc3RyaW5nIH0pLmlkO1xyXG4gICAgICAgICAgc3RyaXBlQ3VzdG9tZXJJZCA9IChleGlzdGluZ0NsaWVudCBhcyB7IHN0cmlwZV9jdXN0b21lcl9pZDogc3RyaW5nIHwgbnVsbCB9KVxyXG4gICAgICAgICAgICAuc3RyaXBlX2N1c3RvbWVyX2lkO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zdCBjbGllbnRFbWFpbCA9IGVtYWlsIHx8ICh1c2VyPy5lbWFpbCBhcyBzdHJpbmcpO1xyXG4gICAgICAgICAgaWYgKCFjbGllbnRFbWFpbClcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRW1haWwgaXMgcmVxdWlyZWQgdG8gY3JlYXRlIGNsaWVudCBhY2NvdW50XCIpO1xyXG5cclxuICAgICAgICAgIGNvbnN0IHsgZGF0YTogbmV3Q2xpZW50LCBlcnJvcjogY2xpZW50RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAgIC5mcm9tKFwiY2xpZW50XCIpXHJcbiAgICAgICAgICAgIC5pbnNlcnQoW1xyXG4gICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcclxuICAgICAgICAgICAgICAgIGZpcnN0X25hbWU6IGZpcnN0TmFtZSxcclxuICAgICAgICAgICAgICAgIGxhc3RfbmFtZTogbGFzdE5hbWUsXHJcbiAgICAgICAgICAgICAgICBlbWFpbDogY2xpZW50RW1haWwsXHJcbiAgICAgICAgICAgICAgICBwaG9uZTogZm9ybURhdGEucGhvbmUgfHwgXCJcIixcclxuICAgICAgICAgICAgICAgIGFkZHJlc3M6IGZvcm1EYXRhLmFkZHJlc3MgfHwgXCJcIixcclxuICAgICAgICAgICAgICAgIGNpdHk6IGZvcm1EYXRhLmNpdHkgfHwgXCJcIixcclxuICAgICAgICAgICAgICAgIHBvc3RhbF9jb2RlOiBmb3JtRGF0YS5wb3N0YWxDb2RlIHx8IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBjb3VudHJ5OiBmb3JtRGF0YS5jb3VudHJ5IHx8IFwiXCIsXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgXSlcclxuICAgICAgICAgICAgLnNlbGVjdChcImlkXCIpXHJcbiAgICAgICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgICAgICBpZiAoIWNsaWVudEVycm9yICYmIG5ld0NsaWVudClcclxuICAgICAgICAgICAgY2xpZW50SWQgPSAobmV3Q2xpZW50IGFzIHsgaWQ6IHN0cmluZyB9KS5pZDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjbGllbnRJZCAmJiAhc3RyaXBlQ3VzdG9tZXJJZCkge1xyXG4gICAgICAgIGNvbnN0IGNsaWVudEVtYWlsID0gZW1haWwgfHwgKHVzZXI/LmVtYWlsIGFzIHN0cmluZyk7XHJcbiAgICAgICAgY29uc3QgY2xpZW50TmFtZSA9IGAke2ZpcnN0TmFtZX0gJHtsYXN0TmFtZX1gLnRyaW0oKTtcclxuICAgICAgICAvLyBOZSBjcsOpZXIgbGUgY2xpZW50IFN0cmlwZSBxdWUgc2kgb24gYSB1biBub20gdmFsaWRlIChqYW1haXMgZW4gdGFudCBxdSdpbnZpdMOpKVxyXG4gICAgICAgIGlmIChjbGllbnROYW1lKSB7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBjdXN0b21lciA9IGF3YWl0IHN0cmlwZS5jdXN0b21lcnMuY3JlYXRlKHtcclxuICAgICAgICAgICAgICBlbWFpbDogY2xpZW50RW1haWwsXHJcbiAgICAgICAgICAgICAgbmFtZTogY2xpZW50TmFtZSxcclxuICAgICAgICAgICAgICBwaG9uZTogKGZvcm1EYXRhLnBob25lIGFzIHN0cmluZykgfHwgdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBjbGllbnRfaWQ6IGNsaWVudElkLFxyXG4gICAgICAgICAgICAgICAgdXNlcl9pZDogdXNlcklkIHx8IFwiXCIsXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHN0cmlwZUN1c3RvbWVySWQgPSBjdXN0b21lci5pZDtcclxuICAgICAgICAgICAgYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgICAgICAuZnJvbShcImNsaWVudFwiKVxyXG4gICAgICAgICAgICAgIC51cGRhdGUoeyBzdHJpcGVfY3VzdG9tZXJfaWQ6IHN0cmlwZUN1c3RvbWVySWQgfSlcclxuICAgICAgICAgICAgICAuZXEoXCJpZFwiLCBjbGllbnRJZCk7XHJcbiAgICAgICAgICB9IGNhdGNoIHtcclxuICAgICAgICAgICAgLy8gQ29udGludWUgd2l0aG91dCBTdHJpcGUgY3VzdG9tZXIsIHVzZSBjdXN0b21lcl9lbWFpbCBpbnN0ZWFkXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoc3VibWlzc2lvbklkICYmIHN1Ym1pc3Npb24pIHtcclxuICAgICAgICBjb25zdCBzdWIgPSBzdWJtaXNzaW9uIGFzIHsgZGF0YT86IHsgY3VycmVuY3k/OiBzdHJpbmcgfSB9O1xyXG4gICAgICAgIGlmICghYm9keS5jdXJyZW5jeSAmJiBzdWIuZGF0YT8uY3VycmVuY3kpIHtcclxuICAgICAgICAgIGN1cnJlbmN5ID0gKHN1Yi5kYXRhLmN1cnJlbmN5IHx8IFwiRVVSXCIpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBzdWJtaXNzaW9uRGF0YSA9IHtcclxuICAgICAgICBjbGllbnRfaWQ6IGNsaWVudElkLFxyXG4gICAgICAgIHN0YXR1czogXCJwZW5kaW5nX3BheW1lbnRcIixcclxuICAgICAgICBmaXJzdF9uYW1lOiBmb3JtRGF0YS5maXJzdE5hbWUsXHJcbiAgICAgICAgbGFzdF9uYW1lOiBmb3JtRGF0YS5sYXN0TmFtZSxcclxuICAgICAgICBlbWFpbDogZm9ybURhdGEuZW1haWwsXHJcbiAgICAgICAgcGhvbmU6IGZvcm1EYXRhLnBob25lIHx8IFwiXCIsXHJcbiAgICAgICAgYWRkcmVzczogZm9ybURhdGEuYWRkcmVzcyxcclxuICAgICAgICBjaXR5OiBmb3JtRGF0YS5jaXR5LFxyXG4gICAgICAgIHBvc3RhbF9jb2RlOiBmb3JtRGF0YS5wb3N0YWxDb2RlLFxyXG4gICAgICAgIGNvdW50cnk6IGZvcm1EYXRhLmNvdW50cnksXHJcbiAgICAgICAgbm90ZXM6IGZvcm1EYXRhLm5vdGVzID8/IG51bGwsXHJcbiAgICAgICAgZ2NsaWQ6IGZvcm1EYXRhLmdjbGlkID8/IG51bGwsXHJcbiAgICAgICAgYXBwb2ludG1lbnRfZGF0ZTogZm9ybURhdGEuYXBwb2ludG1lbnREYXRlLFxyXG4gICAgICAgIGFwcG9pbnRtZW50X3RpbWU6IGZvcm1EYXRhLmFwcG9pbnRtZW50VGltZSxcclxuICAgICAgICB0aW1lem9uZTogZm9ybURhdGEudGltZXpvbmUsXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgc2Vzc2lvbl9pZDogZm9ybURhdGEuc2Vzc2lvbklkID8/IG51bGwsXHJcbiAgICAgICAgICBzZWxlY3RlZFNlcnZpY2VzOiBmb3JtRGF0YS5zZWxlY3RlZFNlcnZpY2VzLFxyXG4gICAgICAgICAgc2VydmljZURvY3VtZW50czogZm9ybURhdGEuc2VydmljZURvY3VtZW50cyxcclxuICAgICAgICAgIHNpZ25hdG9yaWVzOiBmb3JtRGF0YS5zaWduYXRvcmllcyB8fCBbXSxcclxuICAgICAgICAgIHNpZ25hdG9yaWVzQ291bnQ6IGZvcm1EYXRhLnNpZ25hdG9yaWVzQ291bnQgfHwgMCxcclxuICAgICAgICAgIGFkZGl0aW9uYWxTaWduYXRvcmllc0NvdW50OiBmb3JtRGF0YS5hZGRpdGlvbmFsU2lnbmF0b3JpZXNDb3VudCB8fCAwLFxyXG4gICAgICAgICAgc2lnbmF0b3J5Q291bnQ6IGZvcm1EYXRhLnNpZ25hdG9yeUNvdW50ID8/IGZvcm1EYXRhLnNpZ25hdG9yaWVzQ291bnQgPz8gbnVsbCxcclxuICAgICAgICAgIGN1cnJlbmN5LFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCB7IGRhdGE6IG5ld1N1Ym1pc3Npb24sIGVycm9yOiBzdWJtaXNzaW9uRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oXCJzdWJtaXNzaW9uXCIpXHJcbiAgICAgICAgLmluc2VydChbc3VibWlzc2lvbkRhdGFdKVxyXG4gICAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChzdWJtaXNzaW9uRXJyb3IpXHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBzdWJtaXNzaW9uOiBcIiArIHN1Ym1pc3Npb25FcnJvci5tZXNzYWdlKTtcclxuICAgICAgc3VibWlzc2lvbiA9IG5ld1N1Ym1pc3Npb24gYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XHJcbiAgICAgIHN1Ym1pc3Npb25JZCA9IChuZXdTdWJtaXNzaW9uIGFzIHsgaWQ6IHN0cmluZyB9KS5pZDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoc3VibWlzc2lvbklkICYmIHN1Ym1pc3Npb24pIHtcclxuICAgICAgY29uc3Qgc3ViID0gc3VibWlzc2lvbiBhcyB7IGRhdGE/OiB7IGN1cnJlbmN5Pzogc3RyaW5nIH0gfTtcclxuICAgICAgaWYgKCFib2R5LmN1cnJlbmN5ICYmIHN1Yi5kYXRhPy5jdXJyZW5jeSkge1xyXG4gICAgICAgIGN1cnJlbmN5ID0gKHN1Yi5kYXRhLmN1cnJlbmN5IHx8IFwiRVVSXCIpLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHNlcnZpY2VzLCBlcnJvcjogc2VydmljZXNFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oXCJzZXJ2aWNlc1wiKVxyXG4gICAgICAuc2VsZWN0KFwiKlwiKVxyXG4gICAgICAuZXEoXCJpc19hY3RpdmVcIiwgdHJ1ZSk7XHJcblxyXG4gICAgaWYgKHNlcnZpY2VzRXJyb3IpXHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBmZXRjaCBzZXJ2aWNlczogXCIgKyBzZXJ2aWNlc0Vycm9yLm1lc3NhZ2UpO1xyXG5cclxuICAgIGNvbnN0IHNlcnZpY2VzTWFwOiBSZWNvcmQ8XHJcbiAgICAgIHN0cmluZyxcclxuICAgICAgeyBuYW1lOiBzdHJpbmc7IGJhc2VfcHJpY2U6IG51bWJlcjsgcHJpY2VfdXNkPzogbnVtYmVyOyBwcmljZV9nYnA/OiBudW1iZXIgfVxyXG4gICAgPiA9IHt9O1xyXG4gICAgKHNlcnZpY2VzIHx8IFtdKS5mb3JFYWNoKFxyXG4gICAgICAoczogeyBzZXJ2aWNlX2lkOiBzdHJpbmc7IG5hbWU6IHN0cmluZzsgYmFzZV9wcmljZTogbnVtYmVyOyBwcmljZV91c2Q/OiBudW1iZXI7IHByaWNlX2dicD86IG51bWJlciB9KSA9PiB7XHJcbiAgICAgICAgc2VydmljZXNNYXBbcy5zZXJ2aWNlX2lkXSA9IHtcclxuICAgICAgICAgIG5hbWU6IHMubmFtZSxcclxuICAgICAgICAgIGJhc2VfcHJpY2U6IHMuYmFzZV9wcmljZSxcclxuICAgICAgICAgIHByaWNlX3VzZDogcy5wcmljZV91c2QsXHJcbiAgICAgICAgICBwcmljZV9nYnA6IHMucHJpY2VfZ2JwLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBvcHRpb25zIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbShcIm9wdGlvbnNcIilcclxuICAgICAgLnNlbGVjdChcIipcIilcclxuICAgICAgLmVxKFwiaXNfYWN0aXZlXCIsIHRydWUpO1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnNNYXA6IFJlY29yZDxcclxuICAgICAgc3RyaW5nLFxyXG4gICAgICB7IG5hbWU6IHN0cmluZzsgYWRkaXRpb25hbF9wcmljZTogbnVtYmVyOyBwcmljZV91c2Q/OiBudW1iZXI7IHByaWNlX2dicD86IG51bWJlciB9XHJcbiAgICA+ID0ge307XHJcbiAgICAob3B0aW9ucyB8fCBbXSkuZm9yRWFjaChcclxuICAgICAgKG86IHsgb3B0aW9uX2lkOiBzdHJpbmc7IG5hbWU6IHN0cmluZzsgYWRkaXRpb25hbF9wcmljZTogbnVtYmVyOyBwcmljZV91c2Q/OiBudW1iZXI7IHByaWNlX2dicD86IG51bWJlciB9KSA9PiB7XHJcbiAgICAgICAgb3B0aW9uc01hcFtvLm9wdGlvbl9pZF0gPSB7XHJcbiAgICAgICAgICBuYW1lOiBvLm5hbWUsXHJcbiAgICAgICAgICBhZGRpdGlvbmFsX3ByaWNlOiBvLmFkZGl0aW9uYWxfcHJpY2UsXHJcbiAgICAgICAgICBwcmljZV91c2Q6IG8ucHJpY2VfdXNkLFxyXG4gICAgICAgICAgcHJpY2VfZ2JwOiBvLnByaWNlX2dicCxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICApO1xyXG5cclxuICAgIGZ1bmN0aW9uIGdldFNlcnZpY2VQcmljZUZvclN0cmlwZShcclxuICAgICAgc2VydmljZTogeyBiYXNlX3ByaWNlOiBudW1iZXI7IHByaWNlX3VzZD86IG51bWJlcjsgcHJpY2VfZ2JwPzogbnVtYmVyIH0sXHJcbiAgICAgIGN1cnI6IHN0cmluZ1xyXG4gICAgKTogbnVtYmVyIHtcclxuICAgICAgaWYgKGN1cnIgPT09IFwiVVNEXCIgJiYgc2VydmljZS5wcmljZV91c2QgIT0gbnVsbCkgcmV0dXJuIHNlcnZpY2UucHJpY2VfdXNkO1xyXG4gICAgICBpZiAoY3VyciA9PT0gXCJHQlBcIiAmJiBzZXJ2aWNlLnByaWNlX2dicCAhPSBudWxsKSByZXR1cm4gc2VydmljZS5wcmljZV9nYnA7XHJcbiAgICAgIHJldHVybiBjb252ZXJ0UHJpY2VUb01hdGNoQ2xpZW50KHNlcnZpY2UuYmFzZV9wcmljZSA/PyAwLCBjdXJyKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGdldE9wdGlvblByaWNlRm9yU3RyaXBlKFxyXG4gICAgICBvcHRpb246IHsgYWRkaXRpb25hbF9wcmljZTogbnVtYmVyOyBwcmljZV91c2Q/OiBudW1iZXI7IHByaWNlX2dicD86IG51bWJlciB9LFxyXG4gICAgICBjdXJyOiBzdHJpbmdcclxuICAgICk6IG51bWJlciB7XHJcbiAgICAgIGlmIChjdXJyID09PSBcIlVTRFwiICYmIG9wdGlvbi5wcmljZV91c2QgIT0gbnVsbCkgcmV0dXJuIG9wdGlvbi5wcmljZV91c2Q7XHJcbiAgICAgIGlmIChjdXJyID09PSBcIkdCUFwiICYmIG9wdGlvbi5wcmljZV9nYnAgIT0gbnVsbCkgcmV0dXJuIG9wdGlvbi5wcmljZV9nYnA7XHJcbiAgICAgIHJldHVybiBjb252ZXJ0UHJpY2VUb01hdGNoQ2xpZW50KG9wdGlvbi5hZGRpdGlvbmFsX3ByaWNlID8/IDAsIGN1cnIpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGxpbmVJdGVtczogU3RyaXBlLkNoZWNrb3V0LlNlc3Npb25DcmVhdGVQYXJhbXMuTGluZUl0ZW1bXSA9IFtdO1xyXG4gICAgY29uc3Qgb3B0aW9uQ291bnRzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XHJcbiAgICBjb25zdCBzZWxlY3RlZFNlcnZpY2VzID0gKGZvcm1EYXRhLnNlbGVjdGVkU2VydmljZXMgYXMgc3RyaW5nW10pIHx8IFtdO1xyXG4gICAgY29uc3Qgc2VydmljZURvY3VtZW50cyA9IChmb3JtRGF0YS5zZXJ2aWNlRG9jdW1lbnRzIGFzIFJlY29yZDxcclxuICAgICAgc3RyaW5nLFxyXG4gICAgICBBcnJheTx7IHNlbGVjdGVkT3B0aW9ucz86IHN0cmluZ1tdIHwgc3RyaW5nIH0+XHJcbiAgICA+KSB8fCB7fTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IHNlcnZpY2VJZCBvZiBzZWxlY3RlZFNlcnZpY2VzKSB7XHJcbiAgICAgIGNvbnN0IHNlcnZpY2UgPSBzZXJ2aWNlc01hcFtzZXJ2aWNlSWRdO1xyXG4gICAgICBpZiAoIXNlcnZpY2UpIGNvbnRpbnVlO1xyXG4gICAgICBjb25zdCBkb2NzID0gc2VydmljZURvY3VtZW50c1tzZXJ2aWNlSWRdIHx8IFtdO1xyXG4gICAgICBjb25zdCBkb2N1bWVudENvdW50ID0gZG9jcy5sZW5ndGg7XHJcbiAgICAgIGlmIChkb2N1bWVudENvdW50ID09PSAwKSBjb250aW51ZTtcclxuXHJcbiAgICAgIGNvbnN0IHByaWNlSW5DdXJyZW5jeSA9IGdldFNlcnZpY2VQcmljZUZvclN0cmlwZShzZXJ2aWNlLCBjdXJyZW5jeSk7XHJcbiAgICAgIGNvbnN0IHVuaXRBbW91bnQgPVxyXG4gICAgICAgIGN1cnJlbmN5ID09PSBcIkpQWVwiXHJcbiAgICAgICAgICA/IE1hdGgucm91bmQocHJpY2VJbkN1cnJlbmN5KVxyXG4gICAgICAgICAgOiBNYXRoLnJvdW5kKHByaWNlSW5DdXJyZW5jeSAqIDEwMCk7XHJcblxyXG4gICAgICBsaW5lSXRlbXMucHVzaCh7XHJcbiAgICAgICAgcHJpY2VfZGF0YToge1xyXG4gICAgICAgICAgY3VycmVuY3k6IHN0cmlwZUN1cnJlbmN5LFxyXG4gICAgICAgICAgcHJvZHVjdF9kYXRhOiB7XHJcbiAgICAgICAgICAgIG5hbWU6IGAke3NlcnZpY2UubmFtZX0gKCR7ZG9jdW1lbnRDb3VudH0gZG9jdW1lbnQke2RvY3VtZW50Q291bnQgPiAxID8gXCJzXCIgOiBcIlwifSlgLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHVuaXRfYW1vdW50OiB1bml0QW1vdW50LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcXVhbnRpdHk6IGRvY3VtZW50Q291bnQsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZm9yIChjb25zdCBkb2Mgb2YgZG9jcykge1xyXG4gICAgICAgIGxldCBvcHRpb25zQXJyYXk6IHN0cmluZ1tdID0gW107XHJcbiAgICAgICAgY29uc3Qgb3B0cyA9IGRvYy5zZWxlY3RlZE9wdGlvbnM7XHJcbiAgICAgICAgaWYgKG9wdHMpIHtcclxuICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG9wdHMpKSBvcHRpb25zQXJyYXkgPSBvcHRzO1xyXG4gICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG9wdHMgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKG9wdHMpO1xyXG4gICAgICAgICAgICAgIG9wdGlvbnNBcnJheSA9IEFycmF5LmlzQXJyYXkocGFyc2VkKSA/IHBhcnNlZCA6IFtvcHRzXTtcclxuICAgICAgICAgICAgfSBjYXRjaCB7XHJcbiAgICAgICAgICAgICAgb3B0aW9uc0FycmF5ID0gW29wdHNdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBvcHRpb25zQXJyYXkgPSBbb3B0c107XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9wdGlvbnNBcnJheS5mb3JFYWNoKChvcHRJZCkgPT4ge1xyXG4gICAgICAgICAgb3B0aW9uQ291bnRzW29wdElkXSA9IChvcHRpb25Db3VudHNbb3B0SWRdIHx8IDApICsgMTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZvciAoY29uc3QgW29wdGlvbklkLCBjb3VudF0gb2YgT2JqZWN0LmVudHJpZXMob3B0aW9uQ291bnRzKSkge1xyXG4gICAgICBjb25zdCBvcHRpb24gPSBvcHRpb25zTWFwW29wdGlvbklkXTtcclxuICAgICAgaWYgKCFvcHRpb24pIGNvbnRpbnVlO1xyXG4gICAgICBjb25zdCBwcmljZUluQ3VycmVuY3kgPSBnZXRPcHRpb25QcmljZUZvclN0cmlwZShvcHRpb24sIGN1cnJlbmN5KTtcclxuICAgICAgaWYgKHByaWNlSW5DdXJyZW5jeSA8PSAwKSBjb250aW51ZTtcclxuICAgICAgY29uc3QgdW5pdEFtb3VudCA9XHJcbiAgICAgICAgY3VycmVuY3kgPT09IFwiSlBZXCJcclxuICAgICAgICAgID8gTWF0aC5yb3VuZChwcmljZUluQ3VycmVuY3kpXHJcbiAgICAgICAgICA6IE1hdGgucm91bmQocHJpY2VJbkN1cnJlbmN5ICogMTAwKTtcclxuICAgICAgbGluZUl0ZW1zLnB1c2goe1xyXG4gICAgICAgIHByaWNlX2RhdGE6IHtcclxuICAgICAgICAgIGN1cnJlbmN5OiBzdHJpcGVDdXJyZW5jeSxcclxuICAgICAgICAgIHByb2R1Y3RfZGF0YToge1xyXG4gICAgICAgICAgICBuYW1lOiBgJHtvcHRpb24ubmFtZX0gKCR7Y291bnR9IGRvY3VtZW50JHtjb3VudCA+IDEgPyBcInNcIiA6IFwiXCJ9KWAsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgdW5pdF9hbW91bnQ6IHVuaXRBbW91bnQsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBxdWFudGl0eTogY291bnQsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGRlbGl2ZXJ5TWV0aG9kID0gKGZvcm1EYXRhLmRlbGl2ZXJ5TWV0aG9kIGFzIHN0cmluZykgfHwgXCJlbWFpbFwiO1xyXG4gICAgY29uc3QgZGVsaXZlcnlQb3N0YWxDb3N0RVVSID1cclxuICAgICAgKGZvcm1EYXRhLmRlbGl2ZXJ5UG9zdGFsQ29zdEVVUiBhcyBudW1iZXIpIHx8IDA7XHJcblxyXG4gICAgaWYgKGRlbGl2ZXJ5TWV0aG9kID09PSBcInBvc3RhbFwiICYmIGRlbGl2ZXJ5UG9zdGFsQ29zdEVVUiA+IDApIHtcclxuICAgICAgY29uc3QgZGVsaXZlcnlDb3N0SW5DdXJyZW5jeSA9IGNvbnZlcnRQcmljZVRvTWF0Y2hDbGllbnQoXHJcbiAgICAgICAgZGVsaXZlcnlQb3N0YWxDb3N0RVVSLFxyXG4gICAgICAgIGN1cnJlbmN5XHJcbiAgICAgICk7XHJcbiAgICAgIGNvbnN0IHVuaXRBbW91bnQgPVxyXG4gICAgICAgIGN1cnJlbmN5ID09PSBcIkpQWVwiXHJcbiAgICAgICAgICA/IE1hdGgucm91bmQoZGVsaXZlcnlDb3N0SW5DdXJyZW5jeSlcclxuICAgICAgICAgIDogTWF0aC5yb3VuZChkZWxpdmVyeUNvc3RJbkN1cnJlbmN5ICogMTAwKTtcclxuICAgICAgbGluZUl0ZW1zLnB1c2goe1xyXG4gICAgICAgIHByaWNlX2RhdGE6IHtcclxuICAgICAgICAgIGN1cnJlbmN5OiBzdHJpcGVDdXJyZW5jeSxcclxuICAgICAgICAgIHByb2R1Y3RfZGF0YToge1xyXG4gICAgICAgICAgICBuYW1lOiBcIlBoeXNpY2FsIERlbGl2ZXJ5IChESEwgRXhwcmVzcylcIixcclxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGBQb3N0YWwgZGVsaXZlcnkgdmlhIERITCBFeHByZXNzICgke2RlbGl2ZXJ5UG9zdGFsQ29zdEVVUn0gRVVSKWAsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgdW5pdF9hbW91bnQ6IHVuaXRBbW91bnQsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBxdWFudGl0eTogMSxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYWRkaXRpb25hbFNpZ25hdG9yaWVzQ291bnQgPVxyXG4gICAgICAoZm9ybURhdGEuYWRkaXRpb25hbFNpZ25hdG9yaWVzQ291bnQgYXMgbnVtYmVyKSB8fCAwO1xyXG4gICAgY29uc3QgYWRkaXRpb25hbFNpZ25hdG9yaWVzQ29zdEVVUiA9XHJcbiAgICAgIChmb3JtRGF0YS5hZGRpdGlvbmFsU2lnbmF0b3JpZXNDb3N0IGFzIG51bWJlcikgfHwgMDtcclxuXHJcbiAgICBpZiAoYWRkaXRpb25hbFNpZ25hdG9yaWVzQ291bnQgPiAwICYmIGFkZGl0aW9uYWxTaWduYXRvcmllc0Nvc3RFVVIgPiAwKSB7XHJcbiAgICAgIGNvbnN0IGNvc3QgPSBjb252ZXJ0UHJpY2VUb01hdGNoQ2xpZW50KFxyXG4gICAgICAgIGFkZGl0aW9uYWxTaWduYXRvcmllc0Nvc3RFVVIsXHJcbiAgICAgICAgY3VycmVuY3lcclxuICAgICAgKTtcclxuICAgICAgY29uc3QgdW5pdFByaWNlID0gY29zdCAvIGFkZGl0aW9uYWxTaWduYXRvcmllc0NvdW50O1xyXG4gICAgICBjb25zdCB1bml0QW1vdW50ID1cclxuICAgICAgICBjdXJyZW5jeSA9PT0gXCJKUFlcIlxyXG4gICAgICAgICAgPyBNYXRoLnJvdW5kKHVuaXRQcmljZSlcclxuICAgICAgICAgIDogTWF0aC5yb3VuZCh1bml0UHJpY2UgKiAxMDApO1xyXG4gICAgICBsaW5lSXRlbXMucHVzaCh7XHJcbiAgICAgICAgcHJpY2VfZGF0YToge1xyXG4gICAgICAgICAgY3VycmVuY3k6IHN0cmlwZUN1cnJlbmN5LFxyXG4gICAgICAgICAgcHJvZHVjdF9kYXRhOiB7XHJcbiAgICAgICAgICAgIG5hbWU6IGBBZGRpdGlvbmFsIFNpZ25hdG9yaWVzICgke2FkZGl0aW9uYWxTaWduYXRvcmllc0NvdW50fSBzaWduYXRvcnkke2FkZGl0aW9uYWxTaWduYXRvcmllc0NvdW50ID4gMSA/IFwiaWVzXCIgOiBcIlwifSlgLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYEFkZGl0aW9uYWwgc2lnbmF0b3JpZXM6ICR7YWRkaXRpb25hbFNpZ25hdG9yaWVzQ291bnR9IMOXIDQ14oKsYCxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICB1bml0X2Ftb3VudDogdW5pdEFtb3VudCxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHF1YW50aXR5OiBhZGRpdGlvbmFsU2lnbmF0b3JpZXNDb3VudCxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGxpbmVJdGVtcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgZXJyb3I6IFwiTm8gdmFsaWQgc2VydmljZXMgd2l0aCBkb2N1bWVudHMgc2VsZWN0ZWRcIiB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG9yaWdpbiA9XHJcbiAgICAgIHJlcXVlc3QuaGVhZGVycy5nZXQoXCJvcmlnaW5cIikgfHxcclxuICAgICAgcmVxdWVzdC5uZXh0VXJsLm9yaWdpbiB8fFxyXG4gICAgICBcImh0dHBzOi8vYXBwLm15bm90YXJ5LmlvXCI7XHJcblxyXG4gICAgY29uc3Qgc2Vzc2lvblBhcmFtczogU3RyaXBlLkNoZWNrb3V0LlNlc3Npb25DcmVhdGVQYXJhbXMgPSB7XHJcbiAgICAgIHBheW1lbnRfbWV0aG9kX3R5cGVzOiBbXCJjYXJkXCJdLFxyXG4gICAgICBsaW5lX2l0ZW1zOiBsaW5lSXRlbXMsXHJcbiAgICAgIG1vZGU6IFwicGF5bWVudFwiLFxyXG4gICAgICBzdWNjZXNzX3VybDogYCR7b3JpZ2lufS9wYXltZW50L3N1Y2Nlc3M/c2Vzc2lvbl9pZD17Q0hFQ0tPVVRfU0VTU0lPTl9JRH1gLFxyXG4gICAgICBjYW5jZWxfdXJsOiBgJHtvcmlnaW59L3BheW1lbnQvZmFpbGVkYCxcclxuICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICBzdWJtaXNzaW9uX2lkOiBzdWJtaXNzaW9uSWQgYXMgc3RyaW5nLFxyXG4gICAgICAgIGNsaWVudF9pZDogY2xpZW50SWQgPz8gXCJcIixcclxuICAgICAgICBhY2NvdW50X2NyZWF0ZWQ6IGFjY291bnRDcmVhdGVkID8gXCJ0cnVlXCIgOiBcImZhbHNlXCIsXHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG5cclxuICAgIGxldCBwcm9tb0NvZGVBcHBsaWVkID0gZmFsc2U7XHJcblxyXG4gICAgaWYgKHByb21vQ29kZUlkKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcHJvbW90aW9uQ29kZSA9IGF3YWl0IHN0cmlwZS5wcm9tb3Rpb25Db2Rlcy5yZXRyaWV2ZShwcm9tb0NvZGVJZCk7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgcHJvbW90aW9uQ29kZS5hY3RpdmUgJiZcclxuICAgICAgICAgIHByb21vdGlvbkNvZGUuY291cG9uPy52YWxpZFxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgY29uc3QgY2FuUmVkZWVtID1cclxuICAgICAgICAgICAgIXByb21vdGlvbkNvZGUubWF4X3JlZGVtcHRpb25zIHx8XHJcbiAgICAgICAgICAgICFwcm9tb3Rpb25Db2RlLnRpbWVzX3JlZGVlbWVkIHx8XHJcbiAgICAgICAgICAgIHByb21vdGlvbkNvZGUudGltZXNfcmVkZWVtZWQgPCBwcm9tb3Rpb25Db2RlLm1heF9yZWRlbXB0aW9ucztcclxuICAgICAgICAgIGlmIChjYW5SZWRlZW0pIHtcclxuICAgICAgICAgICAgc2Vzc2lvblBhcmFtcy5kaXNjb3VudHMgPSBbXHJcbiAgICAgICAgICAgICAgeyBwcm9tb3Rpb25fY29kZTogU3RyaW5nKHByb21vQ29kZUlkKSB9LFxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICBwcm9tb0NvZGVBcHBsaWVkID0gdHJ1ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgIC8vIEZhbGwgdGhyb3VnaCB0byBzZWFyY2ggYnkgY29kZVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFwcm9tb0NvZGVBcHBsaWVkICYmIHByb21vQ29kZSkge1xyXG4gICAgICBjb25zdCBwcm9tb0NvZGVVcHBlciA9IFN0cmluZyhwcm9tb0NvZGUpLnRvVXBwZXJDYXNlKCkudHJpbSgpO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogcHJvbW90aW9uQ29kZXMgfSA9IGF3YWl0IHN0cmlwZS5wcm9tb3Rpb25Db2Rlcy5saXN0KHtcclxuICAgICAgICAgIGNvZGU6IHByb21vQ29kZVVwcGVyLFxyXG4gICAgICAgICAgbGltaXQ6IDEsXHJcbiAgICAgICAgICBhY3RpdmU6IHRydWUsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgcGMgPSBwcm9tb3Rpb25Db2Rlc1swXTtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICBwYyAmJlxyXG4gICAgICAgICAgcGMuYWN0aXZlICYmXHJcbiAgICAgICAgICBwYy5jb3Vwb24/LnZhbGlkXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICBjb25zdCBjYW5SZWRlZW0gPVxyXG4gICAgICAgICAgICAhcGMubWF4X3JlZGVtcHRpb25zIHx8XHJcbiAgICAgICAgICAgICFwYy50aW1lc19yZWRlZW1lZCB8fFxyXG4gICAgICAgICAgICBwYy50aW1lc19yZWRlZW1lZCA8IHBjLm1heF9yZWRlbXB0aW9ucztcclxuICAgICAgICAgIGlmIChjYW5SZWRlZW0pIHtcclxuICAgICAgICAgICAgc2Vzc2lvblBhcmFtcy5kaXNjb3VudHMgPSBbXHJcbiAgICAgICAgICAgICAgeyBwcm9tb3Rpb25fY29kZTogU3RyaW5nKHBjLmlkKSB9LFxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICBwcm9tb0NvZGVBcHBsaWVkID0gdHJ1ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgIC8vIElnbm9yZVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFwcm9tb0NvZGVBcHBsaWVkKSB7XHJcbiAgICAgIHNlc3Npb25QYXJhbXMuYWxsb3dfcHJvbW90aW9uX2NvZGVzID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoc3RyaXBlQ3VzdG9tZXJJZCkge1xyXG4gICAgICBzZXNzaW9uUGFyYW1zLmN1c3RvbWVyID0gc3RyaXBlQ3VzdG9tZXJJZDtcclxuICAgICAgc2Vzc2lvblBhcmFtcy5wYXltZW50X21ldGhvZF9vcHRpb25zID0ge1xyXG4gICAgICAgIGNhcmQ6IHsgc2V0dXBfZnV0dXJlX3VzYWdlOiBcIm9mZl9zZXNzaW9uXCIgfSxcclxuICAgICAgfTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlc3Npb25QYXJhbXMuY3VzdG9tZXJfZW1haWwgPVxyXG4gICAgICAgIChmb3JtRGF0YS5lbWFpbCBhcyBzdHJpbmcpIHx8ICh1c2VyPy5lbWFpbCBhcyBzdHJpbmcpO1xyXG4gICAgICBzZXNzaW9uUGFyYW1zLnBheW1lbnRfbWV0aG9kX29wdGlvbnMgPSB7XHJcbiAgICAgICAgY2FyZDogeyBzZXR1cF9mdXR1cmVfdXNhZ2U6IFwib2ZmX3Nlc3Npb25cIiB9LFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBzdHJpcGUuY2hlY2tvdXQuc2Vzc2lvbnMuY3JlYXRlKHNlc3Npb25QYXJhbXMpO1xyXG5cclxuICAgIGlmIChzdWJtaXNzaW9uSWQpIHtcclxuICAgICAgY29uc3QgeyBkYXRhOiBleGlzdGluZ1N1YiB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbShcInN1Ym1pc3Npb25cIilcclxuICAgICAgICAuc2VsZWN0KFwiZnVubmVsX3N0YXR1c1wiKVxyXG4gICAgICAgIC5lcShcImlkXCIsIHN1Ym1pc3Npb25JZClcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBjb25zdCBvcmRlck1hcDogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHtcclxuICAgICAgICBzdGFydGVkOiAxLFxyXG4gICAgICAgIHNlcnZpY2VzX3NlbGVjdGVkOiAyLFxyXG4gICAgICAgIGRvY3VtZW50c191cGxvYWRlZDogMyxcclxuICAgICAgICBkZWxpdmVyeV9tZXRob2Rfc2VsZWN0ZWQ6IDQsXHJcbiAgICAgICAgcGVyc29uYWxfaW5mb19jb21wbGV0ZWQ6IDUsXHJcbiAgICAgICAgc3VtbWFyeV92aWV3ZWQ6IDYsXHJcbiAgICAgICAgcGF5bWVudF9wZW5kaW5nOiA3LFxyXG4gICAgICAgIHBheW1lbnRfY29tcGxldGVkOiA4LFxyXG4gICAgICAgIHN1Ym1pc3Npb25fY29tcGxldGVkOiA5LFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCBjdXJyZW50T3JkZXIgPVxyXG4gICAgICAgIG9yZGVyTWFwWyhleGlzdGluZ1N1YiBhcyB7IGZ1bm5lbF9zdGF0dXM6IHN0cmluZyB9KT8uZnVubmVsX3N0YXR1cyB8fCBcIlwiXSB8fCAwO1xyXG4gICAgICBpZiAoNyA+IGN1cnJlbnRPcmRlcikge1xyXG4gICAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbShcInN1Ym1pc3Npb25cIilcclxuICAgICAgICAgIC51cGRhdGUoeyBmdW5uZWxfc3RhdHVzOiBcInBheW1lbnRfcGVuZGluZ1wiIH0pXHJcbiAgICAgICAgICAuZXEoXCJpZFwiLCBzdWJtaXNzaW9uSWQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgICAgdXJsOiBzZXNzaW9uLnVybCxcclxuICAgICAgc3VibWlzc2lvbklkLFxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJbY3JlYXRlLWNoZWNrb3V0LXNlc3Npb25dXCIsIGVycm9yKTtcclxuICAgIGNvbnN0IG1lc3NhZ2UgPVxyXG4gICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiUGF5bWVudCBmYWlsZWRcIjtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBtZXNzYWdlIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJTdHJpcGUiLCJjcmVhdGVDbGllbnQiLCJjcmVhdGVTZXJ2ZXJDbGllbnQiLCJjcmVhdGVBZG1pbkNsaWVudCIsIkNMSUVOVF9GQUxMQkFDS19SQVRFUyIsIlVTRCIsIkdCUCIsIkNBRCIsIkFVRCIsIkNIRiIsIkpQWSIsIkNOWSIsImNvbnZlcnRQcmljZVRvTWF0Y2hDbGllbnQiLCJldXJBbW91bnQiLCJ0YXJnZXRDdXJyZW5jeSIsInRvVXBwZXJDYXNlIiwicmF0ZSIsIk1hdGgiLCJyb3VuZCIsIlBPU1QiLCJyZXF1ZXN0IiwiZm9ybURhdGEiLCJzdWJtaXNzaW9uSWQiLCJib2R5IiwianNvbiIsImVycm9yIiwic3RhdHVzIiwiZW1haWwiLCJ0cmltIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJzdHJpcGVTZWNyZXRLZXkiLCJwcm9jZXNzIiwiZW52IiwiU1RSSVBFX1NFQ1JFVF9LRVkiLCJzdXBhYmFzZVVybCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwic3VwYWJhc2VTZXJ2aWNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsInN0cmlwZSIsImFwaVZlcnNpb24iLCJzdXBhYmFzZSIsImN1cnJlbmN5Iiwic3RyaXBlQ3VycmVuY3kiLCJ0b0xvd2VyQ2FzZSIsInByb21vQ29kZSIsInByb21vQ29kZUlkIiwic2VydmVyU3VwYWJhc2UiLCJkYXRhIiwidXNlciIsImF1dGgiLCJnZXRVc2VyIiwic3VibWlzc2lvbiIsImNsaWVudElkIiwic3RyaXBlQ3VzdG9tZXJJZCIsImFjY291bnRDcmVhdGVkIiwiZXhpc3RpbmdTdWJtaXNzaW9uIiwiZmV0Y2hFcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsIm1lc3NhZ2UiLCJjbGllbnRfaWQiLCJzZXNzaW9uSWQiLCJleGlzdGluZ1N1Ym1pc3Npb25zIiwiaW4iLCJvcmRlciIsImFzY2VuZGluZyIsImxpbWl0IiwiZm91bmQiLCJmaW5kIiwicyIsInNlc3Npb25faWQiLCJpZCIsImNsaWVudFJvdyIsInN0cmlwZV9jdXN0b21lcl9pZCIsInN1Ym1pc3Npb25EYXRhIiwiZmlyc3RfbmFtZSIsImxhc3RfbmFtZSIsInBob25lIiwiYWRkcmVzcyIsImNpdHkiLCJwb3N0YWxfY29kZSIsInBvc3RhbENvZGUiLCJjb3VudHJ5Iiwibm90ZXMiLCJnY2xpZCIsImFwcG9pbnRtZW50X2RhdGUiLCJhcHBvaW50bWVudERhdGUiLCJhcHBvaW50bWVudF90aW1lIiwiYXBwb2ludG1lbnRUaW1lIiwidGltZXpvbmUiLCJzZWxlY3RlZFNlcnZpY2VzIiwic2VydmljZURvY3VtZW50cyIsInNpZ25hdG9yaWVzIiwic2lnbmF0b3JpZXNDb3VudCIsImFkZGl0aW9uYWxTaWduYXRvcmllc0NvdW50Iiwic2lnbmF0b3J5Q291bnQiLCJ1cGRhdGVkIiwidXBkYXRlRXJyIiwidXBkYXRlIiwidXNlcklkIiwidXNlcnMiLCJhZG1pbiIsImxpc3RVc2VycyIsImV4aXN0aW5nVXNlciIsInUiLCJwYXNzd29yZCIsImNyeXB0byIsInJhbmRvbVVVSUQiLCJhdXRoRGF0YSIsImF1dGhFcnJvciIsImNyZWF0ZVVzZXIiLCJlbWFpbF9jb25maXJtIiwidXNlcl9tZXRhZGF0YSIsIkVycm9yIiwiZXhpc3RpbmdDbGllbnQiLCJtYXliZVNpbmdsZSIsImNsaWVudEVtYWlsIiwibmV3Q2xpZW50IiwiY2xpZW50RXJyb3IiLCJpbnNlcnQiLCJ1c2VyX2lkIiwiY2xpZW50TmFtZSIsImN1c3RvbWVyIiwiY3VzdG9tZXJzIiwiY3JlYXRlIiwibmFtZSIsInVuZGVmaW5lZCIsIm1ldGFkYXRhIiwic3ViIiwibmV3U3VibWlzc2lvbiIsInN1Ym1pc3Npb25FcnJvciIsInNlcnZpY2VzIiwic2VydmljZXNFcnJvciIsInNlcnZpY2VzTWFwIiwiZm9yRWFjaCIsInNlcnZpY2VfaWQiLCJiYXNlX3ByaWNlIiwicHJpY2VfdXNkIiwicHJpY2VfZ2JwIiwib3B0aW9ucyIsIm9wdGlvbnNNYXAiLCJvIiwib3B0aW9uX2lkIiwiYWRkaXRpb25hbF9wcmljZSIsImdldFNlcnZpY2VQcmljZUZvclN0cmlwZSIsInNlcnZpY2UiLCJjdXJyIiwiZ2V0T3B0aW9uUHJpY2VGb3JTdHJpcGUiLCJvcHRpb24iLCJsaW5lSXRlbXMiLCJvcHRpb25Db3VudHMiLCJzZXJ2aWNlSWQiLCJkb2NzIiwiZG9jdW1lbnRDb3VudCIsImxlbmd0aCIsInByaWNlSW5DdXJyZW5jeSIsInVuaXRBbW91bnQiLCJwdXNoIiwicHJpY2VfZGF0YSIsInByb2R1Y3RfZGF0YSIsInVuaXRfYW1vdW50IiwicXVhbnRpdHkiLCJkb2MiLCJvcHRpb25zQXJyYXkiLCJvcHRzIiwic2VsZWN0ZWRPcHRpb25zIiwiQXJyYXkiLCJpc0FycmF5IiwicGFyc2VkIiwiSlNPTiIsInBhcnNlIiwib3B0SWQiLCJvcHRpb25JZCIsImNvdW50IiwiT2JqZWN0IiwiZW50cmllcyIsImRlbGl2ZXJ5TWV0aG9kIiwiZGVsaXZlcnlQb3N0YWxDb3N0RVVSIiwiZGVsaXZlcnlDb3N0SW5DdXJyZW5jeSIsImRlc2NyaXB0aW9uIiwiYWRkaXRpb25hbFNpZ25hdG9yaWVzQ29zdEVVUiIsImFkZGl0aW9uYWxTaWduYXRvcmllc0Nvc3QiLCJjb3N0IiwidW5pdFByaWNlIiwib3JpZ2luIiwiaGVhZGVycyIsImdldCIsIm5leHRVcmwiLCJzZXNzaW9uUGFyYW1zIiwicGF5bWVudF9tZXRob2RfdHlwZXMiLCJsaW5lX2l0ZW1zIiwibW9kZSIsInN1Y2Nlc3NfdXJsIiwiY2FuY2VsX3VybCIsInN1Ym1pc3Npb25faWQiLCJhY2NvdW50X2NyZWF0ZWQiLCJwcm9tb0NvZGVBcHBsaWVkIiwicHJvbW90aW9uQ29kZSIsInByb21vdGlvbkNvZGVzIiwicmV0cmlldmUiLCJhY3RpdmUiLCJjb3Vwb24iLCJ2YWxpZCIsImNhblJlZGVlbSIsIm1heF9yZWRlbXB0aW9ucyIsInRpbWVzX3JlZGVlbWVkIiwiZGlzY291bnRzIiwicHJvbW90aW9uX2NvZGUiLCJTdHJpbmciLCJwcm9tb0NvZGVVcHBlciIsImxpc3QiLCJjb2RlIiwicGMiLCJhbGxvd19wcm9tb3Rpb25fY29kZXMiLCJwYXltZW50X21ldGhvZF9vcHRpb25zIiwiY2FyZCIsInNldHVwX2Z1dHVyZV91c2FnZSIsImN1c3RvbWVyX2VtYWlsIiwic2Vzc2lvbiIsImNoZWNrb3V0Iiwic2Vzc2lvbnMiLCJleGlzdGluZ1N1YiIsIm9yZGVyTWFwIiwic3RhcnRlZCIsInNlcnZpY2VzX3NlbGVjdGVkIiwiZG9jdW1lbnRzX3VwbG9hZGVkIiwiZGVsaXZlcnlfbWV0aG9kX3NlbGVjdGVkIiwicGVyc29uYWxfaW5mb19jb21wbGV0ZWQiLCJzdW1tYXJ5X3ZpZXdlZCIsInBheW1lbnRfcGVuZGluZyIsInBheW1lbnRfY29tcGxldGVkIiwic3VibWlzc2lvbl9jb21wbGV0ZWQiLCJjdXJyZW50T3JkZXIiLCJmdW5uZWxfc3RhdHVzIiwidXJsIiwiY29uc29sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/create-checkout-session/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase/admin.ts":
/*!*******************************!*\
  !*** ./lib/supabase/admin.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createAdminClient: () => (/* binding */ createAdminClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/index.mjs\");\n\n/**\r\n * Supabase admin client with service role key.\r\n * Use only in API routes / server-side for privileged operations.\r\n */ function createAdminClient() {\n    const url = \"https://jlizwheftlnhoifbqeex.supabase.co\";\n    const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!url || !serviceKey) {\n        throw new Error(\"Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, serviceKey);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2UvYWRtaW4udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBcUQ7QUFFckQ7OztDQUdDLEdBQ00sU0FBU0M7SUFDZCxNQUFNQyxNQUFNQywwQ0FBb0M7SUFDaEQsTUFBTUcsYUFBYUgsUUFBUUMsR0FBRyxDQUFDRyx5QkFBeUI7SUFFeEQsSUFBSSxDQUFDTCxPQUFPLENBQUNJLFlBQVk7UUFDdkIsTUFBTSxJQUFJRSxNQUFNO0lBQ2xCO0lBRUEsT0FBT1IsbUVBQVlBLENBQUNFLEtBQUtJO0FBQzNCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2xpZW50LWRhc2hib2FyZC8uL2xpYi9zdXBhYmFzZS9hZG1pbi50cz84MTZiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcclxuXHJcbi8qKlxyXG4gKiBTdXBhYmFzZSBhZG1pbiBjbGllbnQgd2l0aCBzZXJ2aWNlIHJvbGUga2V5LlxyXG4gKiBVc2Ugb25seSBpbiBBUEkgcm91dGVzIC8gc2VydmVyLXNpZGUgZm9yIHByaXZpbGVnZWQgb3BlcmF0aW9ucy5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVBZG1pbkNsaWVudCgpIHtcclxuICBjb25zdCB1cmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XHJcbiAgY29uc3Qgc2VydmljZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVk7XHJcblxyXG4gIGlmICghdXJsIHx8ICFzZXJ2aWNlS2V5KSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIFNVUEFCQVNFX1VSTCBvciBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZXCIpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGNyZWF0ZUNsaWVudCh1cmwsIHNlcnZpY2VLZXkpO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJjcmVhdGVBZG1pbkNsaWVudCIsInVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzZXJ2aWNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIkVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase/admin.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase/server.ts":
/*!********************************!*\
  !*** ./lib/supabase/server.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createClient: () => (/* binding */ createClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/ssr */ \"(rsc)/./node_modules/@supabase/ssr/dist/module/index.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n\n\nasync function createClient() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    return (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createServerClient)(\"https://jlizwheftlnhoifbqeex.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpsaXp3aGVmdGxuaG9pZmJxZWV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwNjYxODQsImV4cCI6MjA3NjY0MjE4NH0.fgNPzBgLkS7vSpV4cPlS_lvRb4MWp8gn8DPMqXgTbyE\", {\n        cookies: {\n            getAll () {\n                return cookieStore.getAll();\n            },\n            setAll (cookiesToSet) {\n                try {\n                    cookiesToSet.forEach(({ name, value, options })=>cookieStore.set(name, value, options));\n                } catch  {\n                // Ignore in Server Components\n                }\n            }\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2Uvc2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFtRDtBQUNaO0FBRWhDLGVBQWVFO0lBQ3BCLE1BQU1DLGNBQWMsTUFBTUYscURBQU9BO0lBRWpDLE9BQU9ELGlFQUFrQkEsQ0FDdkJJLDBDQUFvQyxFQUNwQ0Esa05BQXlDLEVBQ3pDO1FBQ0VILFNBQVM7WUFDUE87Z0JBQ0UsT0FBT0wsWUFBWUssTUFBTTtZQUMzQjtZQUNBQyxRQUFPQyxZQUFZO2dCQUNqQixJQUFJO29CQUNGQSxhQUFhQyxPQUFPLENBQUMsQ0FBQyxFQUFFQyxJQUFJLEVBQUVDLEtBQUssRUFBRUMsT0FBTyxFQUFFLEdBQzVDWCxZQUFZWSxHQUFHLENBQUNILE1BQU1DLE9BQU9DO2dCQUVqQyxFQUFFLE9BQU07Z0JBQ04sOEJBQThCO2dCQUNoQztZQUNGO1FBQ0Y7SUFDRjtBQUVKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2xpZW50LWRhc2hib2FyZC8uL2xpYi9zdXBhYmFzZS9zZXJ2ZXIudHM/NjYyNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVTZXJ2ZXJDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3NzclwiO1xyXG5pbXBvcnQgeyBjb29raWVzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiO1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNsaWVudCgpIHtcclxuICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKTtcclxuXHJcbiAgcmV0dXJuIGNyZWF0ZVNlcnZlckNsaWVudChcclxuICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXHJcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSEsXHJcbiAgICB7XHJcbiAgICAgIGNvb2tpZXM6IHtcclxuICAgICAgICBnZXRBbGwoKSB7XHJcbiAgICAgICAgICByZXR1cm4gY29va2llU3RvcmUuZ2V0QWxsKCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXRBbGwoY29va2llc1RvU2V0KSB7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb29raWVzVG9TZXQuZm9yRWFjaCgoeyBuYW1lLCB2YWx1ZSwgb3B0aW9ucyB9KSA9PlxyXG4gICAgICAgICAgICAgIGNvb2tpZVN0b3JlLnNldChuYW1lLCB2YWx1ZSwgb3B0aW9ucylcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgICAgICAvLyBJZ25vcmUgaW4gU2VydmVyIENvbXBvbmVudHNcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICB9LFxyXG4gICAgfVxyXG4gICk7XHJcbn1cclxuIl0sIm5hbWVzIjpbImNyZWF0ZVNlcnZlckNsaWVudCIsImNvb2tpZXMiLCJjcmVhdGVDbGllbnQiLCJjb29raWVTdG9yZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImdldEFsbCIsInNldEFsbCIsImNvb2tpZXNUb1NldCIsImZvckVhY2giLCJuYW1lIiwidmFsdWUiLCJvcHRpb25zIiwic2V0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase/server.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tslib","vendor-chunks/iceberg-js","vendor-chunks/cookie","vendor-chunks/stripe","vendor-chunks/qs","vendor-chunks/object-inspect","vendor-chunks/get-intrinsic","vendor-chunks/side-channel-list","vendor-chunks/side-channel-weakmap","vendor-chunks/has-symbols","vendor-chunks/function-bind","vendor-chunks/side-channel-map","vendor-chunks/side-channel","vendor-chunks/get-proto","vendor-chunks/call-bind-apply-helpers","vendor-chunks/dunder-proto","vendor-chunks/math-intrinsics","vendor-chunks/call-bound","vendor-chunks/es-errors","vendor-chunks/gopd","vendor-chunks/es-define-property","vendor-chunks/hasown","vendor-chunks/es-object-atoms"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcreate-checkout-session%2Froute&page=%2Fapi%2Fcreate-checkout-session%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcreate-checkout-session%2Froute.ts&appDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjerem%5COneDrive%5CBureau%5CNouveau%20dossier%20(3)%5Cmy-notary-form%5Cclient-dashboard-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();